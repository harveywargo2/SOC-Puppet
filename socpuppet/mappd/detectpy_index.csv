,title,description,detectType,detectCon,detectLanguage,tags,attackTechnique,attackSoftware,references,pattern,dataSource,dataType,dataCollector,dataForwardTo,dataparser,dataParser,dataStorage,dataTable,dataIndex,dataAccess,dataMap,kqlVar,kqlTable,kqlQuery
1,rolemgt_pid_0030_priv_auth_admin,"['Entra ID Privileged Authentication Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '7be44c8a-adaf-4e2a-84d6-ab2649e08a13'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
2,rolemgt_pid_0025_office_apps_admin,"['Entra ID Office Apps Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '2b745bdf-0803-4d80-aa65-822c4493daac'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
3,rolemgt_pid_0001_global_admin,"['Entra ID Global Admin', 'Role Add, Remove, or Modify Activity']",single_line_match,1,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '62e90394-69f5-4237-9190-012177145e10'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
4,rolemgt_pid_0005_auth_policy_admin,"['Entra ID Auth Policy Admin', 'Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '0526716b-113d-4c15-b2c8-68e3c22b9f80'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
5,rolemgt_pid_0018_global_reader,"['Entra ID Global Reader', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'f2ef992c-3afb-46b9-b7cf-a126ee74c451'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
6,rolemgt_pid_0020_helpdesk_admin,"['Entra ID Helpdesk Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '729827e3-9c14-49f7-bb1b-9608f156bbb8'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
7,rolemgt_pid_0028_security_admin,"['Entra ID Security Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '194ae4cb-b126-40b2-bd5b-6091b380977d'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
8,rolemgt_pid_0011_cloud_device_admin,"['Entra ID Cloud Device Security', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '7698a772-787b-4ac8-901f-60d6b08affd2'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
9,rolemgt_pid_0026_network_admin,"['Entra ID Network', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'd37c8bed-0711-4417-ba38-b4abe66ce4c2'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
10,rolemgt_pid_0022_hybrid_id_admin,"['Entra ID Hybrid ID Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '8ac3fc64-6eca-42ea-9e69-59f4c7b60eb2'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
11,rolemgt_pid_0029_security_operator,"['Entra ID Security Operator', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '5f2222b1-57c3-48ba-8ad5-d4759f1fde6f'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
12,rolemgt_pid_0002_application_admin,"['Entra ID App Admin', 'Role Add, Remove, or Modify Activity']",single_line_match,2,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
13,rolemgt_pid_0013_directory_reader,"['Entra ID Directory Reader', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '88d8e3e3-8f55-4a1e-953a-9b9898b8876b'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
14,rolemgt_pid_0036_permissions_mgt_admin,"['Entra ID Permissions Managment Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'af78dc32-cf4d-46f9-ba4e-4428526346b5'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
15,rolemgt_pid_0019_groups_admin,"['Entra ID Group Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'fdd7a751-b60b-444a-984c-02652fe8fa1c'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
16,rolemgt_pid_0008_cloud_app_admin,"['Entra ID Cloud App Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '158c047a-c907-4556-b7ef-446551a6b5f7'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
17,rolemgt_pid_0021_guest_inviter,"['Entra ID Guest Inviter', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '95e79109-95c0-4d8e-aee3-d01accf2d47b'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
18,rolemgt_pid_0017_directory_sync,"['Entra ID Directory Synchronization Accounts', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'd29b2b05-8046-44ba-8758-1e26182fcf32'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
19,rolemgt_pid_0035_teams_admin,"['Entra ID Teams Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '69091246-20e8-4a56-aa4d-066075b2a7a8'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
20,rolemgt_pid_0003_application_dev,"['Entra ID App Dev', 'Role Add, Remove, or Modify Activity']",single_line_match,2,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'cf1c38e5-3621-4004-a7cb-879624dced7c'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
21,rolemgt_pid_0016_exchange_admin,"['Entra ID Exchange Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '29232cdf-9323-42fd-ade2-1d097af3e4de'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
22,rolemgt_pid_0010_cloud_app_secuirty_admin,"['Entra ID Cloud App Security', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '892c5842-a9a6-463a-8041-72aa08ca3cf6'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
23,rolemgt_pid_0024_password_admin,"['Entra ID Password Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '966707d0-3269-4727-9be2-8c3a10f19b9d'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
24,rolemgt_pid_0033_tier_support,"['Entra ID Partner Tier 1 or Tier 2 Support', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '4ba39ca4-527c-499a-b93d-d9b492c50246'
  or TargetResources contains 'e00e864a-17c5-4a4b-9c06-f5b95a8d5bd8'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
25,rolemgt_pid_0014_directory_writer,"['Entra ID Directory Writer', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '9360feb5-f418-4baa-8175-e2a00bac4301'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
26,rolemgt_pid_0023_intune_admin,"['Entra ID Intune Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '3a2c62db-5318-420d-8d74-23affee5d9d5'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
27,rolemgt_pid_0034_sharepoint_admin,"['Entra ID Sharepoint Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'f28a1f50-f6e7-4571-818b-6a12f2af6b6c'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
28,rolemgt_pid_0031_security_reader,"['Entra ID Security Reader', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '5d6b6bb7-de71-4623-b4af-96380a352509'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
29,rolemgt_pid_0014_domain_name_writer,"['Entra ID Domain Name Writer', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '8329153b-31d0-4727-b945-745eb3bc5f31'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
30,rolemgt_pid_0032_user_admin,"['Entra ID Security Reader', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'fe930be7-5e62-47db-91af-98c3a49a38b1'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
31,rolemgt_pid_0027_priv_role_admin,"['Entra ID Privileged Role Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'e8611ab8-c189-46e8-94e1-60213ab1f814'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
32,rolemgt_pid_0007_ief_keyset_admin,"['Entra ID B2C IEF Keyset Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'aaf43236-0c0d-4d5f-883a-6955382ac081'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
33,rolemgt_pid_0009_billing_admin.yaml,"['Entra ID Billing Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'b0f54661-2d74-4c50-afa3-1ec803f12efe'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
34,rolemgt_pid_0004_auth_admin,"['Entra ID Auth Admin', 'Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'c4e39bd9-1100-46d3-8c65-fb160da0071f'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
35,rolemgt_pid_0006_auth_extension_admin,"['Entra ID Auth Extension Admin', 'Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains '25a516ed-2fa0-40ea-a2d0-12923a21473a'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
36,rolemgt_pid_0012_cap_admin,"['Entra ID CAP Admin', 'Any Role Add, Remove, or Modify Activity']",single_line_match,3,kql,[None],['t1098'],,['ref_role_management.md'],[None],['entra_id'],"['core_directory', 'privileged_identity_management']",azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,role_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'RoleManagement'
| where TargetResources contains 'b1be1c3e-b65d-4f19-8427-f6fa0d97feb9'
| extend PimLog = iff(LoggedByService =~ 'PIM' or Identity =~ 'MS-PIM', 'TRUE', 'FALSE')"
37,trust_pid_0001_setting_modified,['user or app modifies federation settings in the tenant'],single_line_match,1,kql,[None],['t1492'],,['ref_fed_trust.md'],[None],['entra_id'],['core_directory'],azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,directory_management,api_azure_monitor,,,AuditLogs,"| where OperationName =~ ""Set federation settings on domain""
  or OperationName =~ ""Set domain authentication"""
38,usermgt_pid_0003_user_hard_delete,['Identifies accounts that were successfully deleted'],single_line_match,5,kql,[None],[None],,[None],[None],['entra_id'],['core_directory'],azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,user_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'UserManagement'
  and OperationName =~ 'Hard Delete user'
  and Result =~ 'success'"
39,usermgt_pid_0001_user_add,['Identifies accounts that were successfully created'],single_line_match,5,kql,[None],[None],,[None],[None],['entra_id'],['core_directory'],azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,user_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'UserManagement'
  and OperationName =~ 'Add user'
  and Result =~ 'success'"
40,usermgt_pid_0005_guest_invite_bulk_finished,['Identifies accounts that were successfully invited to a tenant via bulk operation'],single_line_match,5,kql,[None],[None],,[None],[None],['entra_id'],['invited_users'],azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,user_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'UserManagement'
  and OperationName =~ 'Bulk invite users - finished (bulk)'"
41,usermgt_pid_0004_guest_user_invite,['Identifies accounts that were successfully invited to a tenant'],single_line_match,5,kql,[None],[None],,[None],[None],['entra_id'],['invited_users'],azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,user_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'UserManagement'
  and OperationName in~ ('Invite external user', 'Invite external user with reset invitation status')
  and Result =~ 'success'"
42,usermgt_pid_0002_user_delete,['Identifies accounts that were successfully deleted'],single_line_match,5,kql,[None],[None],,[None],[None],['entra_id'],['core_directory'],azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,user_management,api_azure_monitor,,,AuditLogs,"| where Category =~ 'UserManagement'
  and OperationName =~ 'Delete user'
  and Result =~ 'success'"
43,user_pid_0002_mfa_fraud_reported,['User reported fraud mfa requested via msft authenticator app'],single_line_match,3,kql,[None],[None],,[None],[None],['entra_id'],['azure_mfa'],azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,user_management,api_azure_monitor,,,AuditLogs,"| where OperationName =~ 'Fraud reported - user is blocked for MFA'
  or OperationName =~ 'Fraud reported - no action taken'"
44,user_pid_0001_mfa_susp_activity_reported,['User reports suspicious activity via authenticator app'],single_line_match,3,kql,[None],[None],,[None],[None],['entra_id'],['azure_mfa'],azure_active_directory,msft_sentinel,,,azure_monitor,audit_logs,user_management,api_azure_monitor,,,AuditLogs,| where OperationName =~ 'Suspicious activity reported'
45,alert_pid_0010_reading_vss,"['MDE EDR Behavior Alert', 'Reading files from volume shadown copies']",single_line_match,2,kql,[None],['t1003'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Reading files from volume shadow copies'
46,alert_pid_0002_process_memory_dump,"['MDE EDR Behavior Alert', 'Process memory dump']",single_line_match,1,kql,[None],['t1003'],,['ref_comsvcs.md'],['ref_comsvcs.md'],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Process memory dump'
47,alert_pid_0011_sus_ldap_query,"['MDE EDR Behavior Alert', 'Suspicious LDAP query']",single_line_match,2,kql,[None],[None],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Suspicious LDAP Query'
48,builtin_pid_0013_edr_suspicious_access_alert,"['MDE EDR Behavior/Memory Alert', 'Suspicious access to LSASS service']",single_line_match,1,kql,[None],['t1003'],,"['ref_gsecdump.md', 'ref_comsvcs.md']","['ref_gsecdump.md', 'ref_comsvcs.md']",['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Suspicious access to LSASS service'
49,alert_pid_0009_malicious_pshell,"['MDE EDR Behavior Alert', 'A malicious Powershell Cmdlet was invoked on the machine']",single_line_match,2,kql,[None],['t1003'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'A malicious Powershell Cmdlet was invoked on the machine'
50,alert_pid_0005_registry_extract,"['MDE EDR Behavior Alert', 'Sensitive data was extracted from registry']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Sensitive data was extracted from registry'
51,alert_pid_0008_registry_export,"['MDE EDR Behavior Alert', 'Suspicious registry export']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Suspicious registry export'
52,generic_pid_0028_edr_sam_info_theft_alert,"['MDE EDR Behavior Alert', 'Sensitive information theft activity via Security Account Manager']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Sensitive information theft activity via Security Account Manager'
53,alert_pid_0001_attempt_steal_creds,"['MDE EDR Behavior Alert', 'Possible attempt to steal credentials']",single_line_match,1,kql,[None],['t1003'],,['ref_nppspy.md'],['ref_nppspy.md'],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Possible attempt to steal credentials'
54,alert_pid_0012_sus_domain_trust,"['MDE EDR Behavior Alert', 'Suspicious Domain Trust Discovery']",single_line_match,2,kql,[None],['t1482'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Suspicious Domain Trust Discovery'
55,alert_pid_0004_suspicious_access,"['MDE EDR Behavior Alert', 'Sensitive credential memory read']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Sensitive credential memory read'
56,alert_pid_0006_sensitive_info_lookup,"['MDE EDR Behavior Alert', 'Sensitive information lookup']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Sensitive information lookup'
57,createdump_pid_0001_dump_files,['Use createdump executable from .NET to create an dump file'],single_line_match,2,kql,[None],['t1003'],,['ref_createdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'createdump'
  and ProcessCommandLine has_all ('-f', '-u')"
58,comsvcs_pid_0001_created_minidump,"['Comsvcs used to create minidump of a pid', 'potential lsass or rdp dump depending on pid']",single_line_match,1,kql,[None],['t1003'],,['ref_comsvcs.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('comsvcs', 'minidump')"
59,comsvcs_pid_0002_called_minidumpw_function,"['comsvcs creating a file', 'possible .dmp file', 'potential lsass/rdp dump']",single_line_match,1,kql,[None],['t1003'],,['ref_comsvcs.md'],[None],['windows_os'],"['file_created', 'file_deleted', 'file_renamed', 'file_modified']",m365d_agent,m365d_security_center,,,m365d_security_center,device_file_events,,api_advanced_hunting,,,DeviceFileEvents,| where InitiatingProcessCommandLine has 'comsvcs'
60,comsvcs_pid_0002_called_minidumpw_function,"['Comsvcs used to create minidump of a pid with function 24 MiniDumpw', 'potential lsass or rdp dump depending on pid']",single_line_match,1,kql,[None],['t1003'],,['ref_comsvcs.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('comsvcs', '#24')
  or ProcessCommandLine has_all ('comsvcs', '-24')"
61,sc_pid_0003_disable_sysmon_service,"['Disable Service with Service Control Manager', 'Sysmon Service Stop', 'Sysmon Service Config Disable']",single_line_match,2,kql,[None],['t1562'],,[None],"['sc config Sysmon start=disabled', 'sc stop Sysmon']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'sc.exe'
  or ProcessVersionInfoOriginalFileName =~ 'sc.exe'
| where ProcessCommandLine has 'Sysmon'
| where ProcessCommandLine has_all ('config', 'start', 'disabled')
  or ProcessCommandLine has 'stop'"
62,sc_pid_0002_disable_windefend_service,"['Disable Service with Service Control Manager', 'WinDefend Service Stop', 'WinDefend Service Config Disable']",single_line_match,2,kql,[None],['t1562'],,[None],"['sc config WinDefend start=disabled', 'sc stop WinDefend']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'sc.exe'
  or ProcessVersionInfoOriginalFileName =~ 'sc.exe'
| where ProcessCommandLine has 'windefend'
| where ProcessCommandLine has_all ('config', 'start', 'disabled')
  or ProcessCommandLine has 'stop'"
63,sc_pid_0005_disable_tanium_service,"['Disable Service with Service Control Manager', 'Tanium Client Service Stop', 'Tanium Client Service Config Disable']",single_line_match,3,kql,[None],['t1562'],,[None],"['sc config Tanium Client start=disabled', 'sc stop Tanium Client']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'sc.exe'
  or ProcessVersionInfoOriginalFileName =~ 'sc.exe'
| where ProcessCommandLine has_all ('tanium', 'client')
| where ProcessCommandLine has_all ('config', 'start', 'disabled')
  or ProcessCommandLine has 'stop'"
64,sc_pid_0001_disable_service,['Disable Arbitrary Service with Service Control Manager'],single_line_match,5,kql,[None],['t1562'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'sc.exe'
  or ProcessVersionInfoOriginalFileName =~ 'sc.exe'
| where ProcessCommandLine has_all ('config', 'start', 'disabled')"
65,sc_pid_0005_disable_tanium_service,"['Disable Service with Service Control Manager', 'Tanium Client Service Stop', 'Tanium Client Service Config Disable']",single_line_match,3,kql,[None],['t1562'],,[None],"['sc stop (service name)', 'sc config (service_name) start= disabled', 'Microsoft Defender Antivirus Service', 'Microsoft Defender Core Service', 'Microsoft Defender Network Inspection Service', 'Microsoft Defender Core Service', 'Windows Defender Advanced Threat Protection Service', 'Windows Security Service', 'Security Center']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'sc.exe'
  or ProcessVersionInfoOriginalFileName =~ 'sc.exe'
| where ProcessCommandLine has_all ('config', 'start', 'disabled')
  or ProcessCommandLine has 'stop'
| where ProcessCommandLine has_all ('microsoft', 'defender')
  or ProcessCommandLine has_all ('threat', 'protection', 'advanced')
  or ProcessCommandLine has_all ('windows', 'security', 'service')
  or ProcessCommandLine has_all ('security', 'center')
"
66,sc_pid_0004_disable_winevt_service,"['Disable Service with Service Control Manager', 'Wn Service Stop', 'Sysmon Service Config Disable']",single_line_match,2,kql,[None],['t1562'],,[None],"['sc config Sysmon start=disabled', 'sc stop Sysmon']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'sc.exe'
  or ProcessVersionInfoOriginalFileName =~ 'sc.exe'
| where ProcessCommandLine has_all ('Windows', 'Event', 'Log')
| where ProcessCommandLine has_all ('config', 'start', 'disabled')
  or ProcessCommandLine has 'stop'"
67,amsi_pid_0001_pshell_bypass_initfalied,"['bypass AMSI inspection', 'https://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/']",single_line_match,3,kql,[None],['t1562'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('Automation', 'AmsiUtils', 'amsiInitFailed', 'setValue')
  and ProcessCommandLine has_any ('null', 'true')"
68,amsi_pid_0002_pshell_bypass_registry_provider.yaml,['bypass AMSI inspection'],single_line_match,3,kql,[None],['t1562'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('AMSI', 'providers')
  and ProcessCommandLine has_any ('HKLM', 'HKEY_LOCAL_MACHINE')
  and ProcessCommandLine has_any('remove-item', 'reg')"
69,net_pid_0005_enterprise_admin_group_add,['net command run to add user to enterprise admins group'],single_line_match,1,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('group', 'Domain', 'admins')
  and ProcessCommandLine contains '/d'
| where ProcessCommandLine contains '/add'"
70,net_pid_0006_domain_group_output_redirected_file,"['net command run', ""output redirected '>' or '>>' to a file"", 'potential recon exfil']",single_line_match,2,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'group'
  and ProcessCommandLine contains '/d'
| where ProcessCommandLine contains '>>'
  or ProcessCommandLine contains '>'
  or ProcessCommandLine contains 'C$'"
71,net_pid_0010_administrators_localgroup_enum,['net command used to add users in localgroup administrators'],single_line_match,2,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('localgroup', 'administrators')
| where ProcessCommandLine contains '/add'"
72,net_pid_0019_user_password_never_expire,"['net CLT used to add user to a domain', 'password set to not expire']",single_line_match,3,kql,[None],['s0039'],,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'user'
| where ProcessCommandLine contains 'net user'
  or ProcessCommandLine contains 'net1 user'
| where ProcessCommandLine has_all ('never', 'expires')"
73,net_pid_0014_localgroup_add,['net command used to add to localgroups'],single_line_match,3,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'localgroup'
| where ProcessCommandLine contains '/add'"
74,net_pid_0001_domain_admin_group_enum,['net command run to list users in domain admins group'],single_line_match,2,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('group', 'Domain', 'Admins')
  and ProcessCommandLine contains '/d'
| where ProcessCommandLine !contains '/add'"
75,net_pid_0018_domain_user_add,"['net CLT used to add domain users', 'net CLT used to show a users password policy/profile']",single_line_match,3,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'user'
  and ProcessCommandLine contains '/d'
| where ProcessCommandLine contains 'net user'
  or ProcessCommandLine contains 'net1 user'
| where ProcessCommandLine contains '/add'"
76,net_pid_0020_view,['net CLT view visible computers'],single_line_match,3,kql,[None],['s0039'],,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'view'"
77,net_pid_0016_user_add,['net CLT used to add users on a device'],single_line_match,3,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'user'
  and ProcessCommandLine !contains '/d'
  and ProcessCommandLine contains '/add'
| where ProcessCommandLine contains 'net user'
  or ProcessCommandLine contains 'net1 user'"
78,net_pid_0021_view_all,['net CLT view visible computers'],single_line_match,3,kql,[None],['s0039'],,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('view', 'all')"
79,net_pid_0017_domain_user_enum.yaml,"['net CLT used to list domain users on a device', 'net CLT used to show a users password policy/profile']",single_line_match,3,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'user'
  and ProcessCommandLine contains '/d'
| where ProcessCommandLine contains 'net user'
  or ProcessCommandLine contains 'net1 user'
| where ProcessCommandLine !contains '/add'
  and ProcessCommandLine !contains '/delete'"
80,net_pid_0004_domain_admin_group_add,['net command run to add user to domain admins group'],single_line_match,1,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('group', 'Domain', 'admins')
  and ProcessCommandLine contains '/d'
| where ProcessCommandLine contains '/add'"
81,net_pid_0007_redirector_output_file,"['net command run', ""output redirected '>' or '>>' to a file"", 'potential recon exfil']",single_line_match,2,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],"['file_create', 'file_rename', 'file_modify', 'file_delete']",m365d_agent,m365d_security_center,,,m365d_security_center,device_file_events,,api_advanced_hunting,,,DeviceFileEvents,"| where InitiatingProcessFileName =~'net.exe'
  or InitiatingProcessFileName =~ 'net1.exe'
| where isnotempty(InitiatingProcessCommandLine)
  and FileName !endswith '.exe'
  and isnotnull(FileSize)"
82,net_pid_0009_administrators_localgroup_enum,['net command used to list users in localgroup administrators'],single_line_match,3,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('localgroup', 'administrators')
| where ProcessCommandLine !contains '/add'"
83,net_pid_0015_user,"['net CLT used to list users on a device', 'net CLt used to show a users password policy/profile']",single_line_match,3,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'user'
  and ProcessCommandLine !contains '/d'
| where ProcessCommandLine contains 'net user'
  or ProcessCommandLine contains 'net1 user'"
84,net_pid_0012_rdp_localgroup_add,['net command used to add users in localgroup remote desktop users'],single_line_match,2,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('localgroup', 'Remote', 'Desktop', 'Users')
| where ProcessCommandLine contains '/add'"
85,net_pid_0011_rdp_localgroup_enum,['net command used to list users in localgroup remote desktop users'],single_line_match,3,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('localgroup', 'Remote', 'Desktop', 'Users')
| where ProcessCommandLine !contains '/add'"
86,net_pid_0002_enterprise_admin_group_enum,['net command run to list users in enterprise admins group'],single_line_match,2,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('group', 'Enterprise', 'Admins')
| where ProcessCommandLine contains '/d'
| where ProcessCommandLine !contains '/add'"
87,net_pid_0013_localgroup_enum,"['net command run to list localgroups', 'will list users in a localgroup']",single_line_match,3,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'localgroup'
| where ProcessCommandLine !contains '/add'"
88,net_pid_0022_stop_windefender,['net CLT used to stop window defender service'],single_line_match,3,kql,[None],"['t1562', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('stop', 'windefend')"
89,net_pid_0023_stop_tanium,['net CLT used to stop tanium services'],single_line_match,2,kql,[None],"['t1562', 's0039']",,['ref_net.md'],"['net stop ""tanium client""', 'net stop ""tanium driver service""']",['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('stop', 'tanium')"
90,net_pid_0008_file_masquerade,['net command line tool masquerading'],single_line_match,2,kql,[None],"['t1036', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessVersionInfoOriginalFileName =~ 'net.exe'
  or ProcessVersionInfoOriginalFileName =~ 'net1.exe'
| where FileName !~ 'net.exe'
  and FileName !~ 'net1.exe'"
91,net_pid_0003_domain_group_enum,"['net command run to list groups on a domain', 'will list users in a group if a group name is passed']",single_line_match,4,kql,[None],"['t1069', 's0039']",,['ref_net.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has 'group'
  and ProcessCommandLine contains '/d'"
92,net_pid_0025_stop_sysmon,['net CLT used to stop sysmon service'],single_line_match,2,kql,[None],"['t1562', 's0039']",,['ref_net.md'],"['net stop ""sysmon""']",['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('stop', 'sysmon')"
93,net_pid_0025_stop_win_event,['net CLT used to stop windows event log service'],single_line_match,2,kql,[None],"['t1562', 's0039']",,['ref_net.md'],"['net stop ""Windows Event Log""']",['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has_any ('net', 'net1')
  and FileName endswith '.exe'
  and ProcessCommandLine has_all ('stop', 'windows', 'event', 'log')"
94,net_pid_0024_stop_defender,['net CLT used to stop Windows/MSFT defender services'],single_line_match,2,kql,[None],"['t1562', 's0039']",,['ref_net.md'],"['net stop (service name)', 'Microsoft Defender Antivirus Service', 'Microsoft Defender Core Service', 'Microsoft Defender Network Inspection Service', 'Microsoft Defender Core Service', 'Windows Defender Advanced Threat Protection Service', 'Windows Security Service', 'Security Center']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'sc.exe'
  or ProcessVersionInfoOriginalFileName =~ 'sc.exe'
| where ProcessCommandLine has_all ('config', 'start', 'disabled')
  or ProcessCommandLine has 'stop'
| where ProcessCommandLine has_all ('microsoft', 'defender')
  or ProcessCommandLine has_all ('threat', 'protection', 'advanced')
  or ProcessCommandLine has_all ('windows', 'security', 'service')
  or ProcessCommandLine has_all ('security', 'center')
"
95,ntdsutil_pid_0002_ifm_ntds,"['This technique uses ""Install from Media"" (IFM), which will extract a copy of the Active Directory database', 'A successful export of the Active Directory database will yield a file modification named ntds.dit to the destination', 'Potential offline password attack']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('ac', 'i', 'ntds')
  or ProcessCommandLine has_all ('activate', 'instance', 'ntds')
| where ProcessCommandLine has 'ifm'
  or ProcessCommandLine has_all ('Install', 'From', 'Media')
| where ProcessCommand has 'create'"
96,ntdspid_0001,['NTDS.dit indicator in commandline'],single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has ('ntds')
  and ProcessCommandLine contains('ntds.dit')"
97,ntdsutil_pid_0001_dump_ntds,"['Sets NTDS or a specific AD LDS instance as the active instance', 'Potential offline password attack']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('ac', 'i', 'ntds')
  or ProcessCommandLine has_all ('activate', 'instance', 'ntds')
| where ProcessCommandLine has 'ifm'
  or ProcessCommandLine has_all ('Install', 'From', 'Media')"
98,ntdspid_0001_copy_vss,"['Requires Volume Shadow Copy Creation', 'Potential offline password attack']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('Globalroot', 'copy', 'ntds')
  and ProcessCommandLine contains 'HarddiskVolumeShadowCopy'
  and ProcessCommandLine contains 'ntds.dit'"
99,mpcmdrun_pid_0001_remove_definitions,"['mpcmdrun', None]",single_line_match,3,kql,[None],['t1562'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('mpcmdrun', 'removedefinitions')"
100,cmdkey_pid_0001_list_creds,['Cmdkey.exe to look for cached credentials on the system'],single_line_match,2,kql,[None],['t1003'],,['ref_createdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('cmdkey', 'list')"
101,nppspy_pid_0004_static_registry_indicator,['NPPSpy added to registry HKCU or HKLM'],single_line_match,1,kql,[None],['t1003'],,['ref_nppspy.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any('HKLM', 'HKCU', 'HKEY_LOCAL_MACHINE', 'HKEY_CURRENT_USER')
| where ProcessCommandLine has 'NPPSpy'
"
102,nppspy_pid_0005_reg_key_value_indicator,"['NPPSpy added to registry HKCU or HKLM', 'Targets CurrentControlSet\\Services & NetworkProvider', 'Targets values Class, ProviderPath, Name']",single_line_match,2,kql,[None],['t1003'],,['ref_nppspy.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any('HKLM', 'HKCU', 'HKEY_LOCAL_MACHINE', 'HKEY_CURRENT_USER')
| where ProcessCommandLine has_all ('CurrentControlSet', 'NetworkProvider')
| where ProcessCommandLine has_all ('Class', 'ProviderPath', 'Name') 
  
"
103,cmstp_pid_0005_spawning_child_process,['cmstp rare activity of cmstp.exe spawning a child process'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where InitiatingProcessFileName =~ 'cmstp.exe'
  or InitiatingProcessVersionInfoOriginalFileName =~ 'cmstp.exe'"
104,cmstp_pid_0006_rare_folder_path,"[""rare activity of cmstp.exe being called from any folder that isn't system32""]",single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'cmstp'
  or ProcessVersionInfoOriginalFileName has 'cmstp'
| where FolderPath !contains @'c:\windows\system32\'"
105,cmstp_pid_0002_executing_inf_file_silent_flag,['cmstp installs a specially formatted .inf with silent flag set'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'cmstp'
  or ProcessVersionInfoOriginalFileName has 'cmstp'
| where ProcessCommandLine contains '.inf'
  and ProcessCommandLine contains '/s'"
106,cmstp_pid_0004_executing_inf_file_single_user_flag,['cmstp installs a specially formatted .inf with single user flag'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'cmstp'
  or ProcessVersionInfoOriginalFileName has 'cmstp'
| where ProcessCommandLine contains '.inf'
  and ProcessCommandLine contains '/su'"
107,cmstp_pid_0001_executing_inf_file,['cmstp installs a specially formatted .inf'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'cmstp'
  or ProcessVersionInfoOriginalFileName has 'cmstp'
| where ProcessCommandLine contains '.inf'"
108,cmstp_pid_0003_executing_inf_all_profiles_flag,['cmstp installs a specially formatted .inf with all profiles flag set'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'cmstp'
  or ProcessVersionInfoOriginalFileName has 'cmstp'
| where ProcessCommandLine contains '.inf'
  and ProcessCommandLine contains '/au'"
109,vss_pid_0001_wmic_shadowcopy.yaml,"['WMIC used to create vss', 'Potential offline password attack']",single_line_match,2,kql,[None],['t1003'],,['ref_vss.md'],[None],['windows_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any ('wmic', 'shadowcopy', 'create')
  and ProcessCommandLine contains 'Volume=c:'"
110,diskshadow_pid_0001_shadowcopy,"['Execute commands to create shadow copy from a script', 'Potential offline password attack']",single_line_match,2,kql,[None],['t1003'],,['ref_vss.md'],[None],['windows_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('diskshadow', '/s')"
111,vssadmin_pid_0001_create_shadow,"['Vssadmin creating volume shadow copy', 'Potential offline password attack']",single_line_match,4,kql,[None],['t1003'],,[None],[None],"['windows_os_server', 'windows_os_domain_controller']",['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('vssadmin', 'create', 'shadow')"
112,vss_pid_0004_symlink,"['Create symlink of Shadow Copy', 'Potential offline password attack']",single_line_match,2,kql,[None],['t1003'],,['ref_vss.md'],[None],['windows_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('mklink', 'globalroot')
  and ProcessCommandLine contains 'HarddiskVolumeShadowcopy'"
113,vss_pid_0002_pshell_gwmi_shadowcopy,"['Powershell Calling WMI Object to Create Shadowcopy', 'Potential offline password attack']",single_line_match,2,kql,[None],['t1003'],,['ref_vss.md'],[None],['windows_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('shadowcopy', 'create', 'ClientAccessible') 
  and ProcessCommandLine contains 'c:'
| where ProcessCommandLine contains 'Get-WMiObject'
  or ProcessCommandLine contains 'gwmi'"
114,vssadmin_pid_0002_create_shadow_c_drive,"['Vssadmin creating volume shadow copy', 'Potential offline password attack']",single_line_match,2,kql,[None],['t1003'],,[None],[None],"['windows_os_server', 'windows_os_domain_controller']",['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('vssadmin', 'create', 'shadow')
  and ProcessCommandLine contains @'/for=c:'"
115,vss_pid_0003_pshell_new_vssshadowcopy,"['Powershell New-VssShadowCopy', 'Potential offline password attack']",single_line_match,2,kql,[None],['t1003'],,['ref_vss.md'],[None],['windows_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('vssshadowcopy', 'new' 'ClientAccessible') 
  and ProcessCommandLine contains 'c:'
  and ProcessCommandLine contains 'New-VssShadowCopy'"
116,vss_pid_0005_globalroot_shadowcopy,"['\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1', 'Potential offline password attack']",single_line_match,2,kql,[None],['t1003'],,['ref_vss.md'],[None],['windows_domain_controller'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'globalroot'
  and ProcessCommandLine contains 'HarddiskVolumeShadowcopy'"
117,nltest_pid_0004_trusted_domains,"['nltest running domain trust commands', 'Returns a list of trusted domains', 'Determines if netlogon session can be established']",single_line_match,2,kql,[None],"['t1482', 's0359']",,['ref_nltest.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('/trusted_domains', 'nltest')
"
118,nltest_pid_0001_dclist,"['Nltest running dclist command flag', 'This command first queries Active Directory for a list of DCs', 'List all DCs in the domain']",single_line_match,2,kql,[None],"['t1018', 's0359']",,['ref_nltest.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('nltest', '/dclist')
"
119,nltest_pid_0002_domain_trust,"['nltest running domain trust commands', 'Returns a list of trusted domains']",single_line_match,2,kql,[None],"['t1482', 's0359']",,['ref_nltest.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('/domain_trusts', 'nltest')
"
120,nltest_pid_0003_dsgetdc,"['nltest running /dsgetdc command flag', 'List Domain Controllers and Info']",single_line_match,2,kql,[None],"['t1018', 's0359']",,['ref_nltest.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('nltest', '/dsgetdc')
"
121,nltest_pid_0006_parentdomain,"['nltest running /parentdomain commands', 'Returns a list of trusted domains']",single_line_match,2,kql,[None],"['t1482', 's0359']",,['ref_nltest.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('/domain_trusts', 'nltest', '/all_trusts')
"
122,nltest_pid_0005_all_trusts,"['nltest running /domain_trusts /all_trusts commands', 'Returns a list of trusted domains']",single_line_match,2,kql,[None],"['t1482', 's0359']",,['ref_nltest.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('/domain_trusts', 'nltest', '/all_trusts')
"
123,lsassdump_pid_0002_av_malware_dynamic,"['Dump Creds from memory', 'Builtin AV Client Heuristic', 'Trojan DumpLsass']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'lsassdump'"
124,presenoker_pid_0003_av_pua_event,"['MDE AV Client Heuristic', 'Presenoker']",single_line_match,1,kql,[None],['t1003'],,['ref_nppspy.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'presenoker'"
125,lsassdump_pid_0001_av_malware_alert,"['Dump Creds from memory', 'Builtin AV Client Heuristic', 'Trojan DumpLsass']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'lsassdump'
  or ThreatFamily contains 'lsassdump'"
126,builtin_pid_0039_av_hacktool_powersploit_event,"['MDE AV Client Heuristic', 'Hacktool PowerSploit']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'powersploit'"
127,registryexfil_pid_0002_av_dynamic,"['MDE AV Client Heuristic', 'Trojan RegistryExfil']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'registryexfil'"
128,lsassdump_pid_0003_av_malware_event,"['Dump Creds from memory', 'Builtin AV Client Heuristic', 'Trojan DumpLsass']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'lsassdump'"
129,rundlllolbin_pid_0001_av_alert,"['Builtin AV Client Heuristic', 'Trojan RundllLolBin']",single_line_match,1,kql,[None],['t1003'],,['ref_comsvcs.md'],['ref_comsvcs.md'],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'rundlllolbin'
  or ThreatFamily contains 'rundlllolbin'"
130,builtin_pid_0036_av_hacktool_powersploit_alert,"['MDE AV Client Heuristic', 'HackTool PowerSploit']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'powersploit'
  or ThreatFamily contains 'powersploit'
"
131,maleficams_pid_0001_av_pshell_alert,"['Builtin AV Client Heuristic', 'PowerShell Malefic Ams']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'maleficams'
  or ThreatFamily contains 'maleficams'"
132,presenoker_pid_0001_av_pua_alert,"['MDE AV Client Heuristic', 'Presenoker']",single_line_match,1,kql,[None],['t1003'],,['ref_nppspy.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'presenoker'
  or ThreatFamily contains 'presenoker'
"
133,rundlllolbin_pid_0001_av_dynamic,"['Builtin AV Client Heuristic', 'Trojan RundllLolBin']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'rundlllolbin'"
134,builtin_pid_0038_av_hacktool_powersploit_dynamic,"['MDE AV Client Heuristic', 'Hacktool PowerSploit']",['single_line_match'],1,kql,[None],['t1003'],,[None],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'powersploit'"
135,nanodump_pid_0002_av_hacktool_dynamic,"['MDE AV Client Heuristic', 'Hacktool NanoDump']",['single_line_match'],1,kql,[None],['t1003'],,[None],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'nanodump'"
136,presenoker_pid_0002_av_pua_dynamic,"['MDE AV Client Heuristic', 'Presenoker']",['single_line_match'],1,kql,[None],['t1003'],,['ref_nppspy.md'],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'presenoker'"
137,registryexfil_pid_0001_av_alert,"['MDE AV Client Heuristic', 'Trojan RegistryExfil']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'registryexfil'
  or ThreatFamily contains 'registryexfil'
"
138,posderscan_pid_0001_av_trojan_alert,"['Builtin AV Client Heuristic', 'Trojan PosderCan']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'posdercan'
  or ThreatFamilyName contains 'posdercan'"
139,dumplsass_pid_0001_av_hacktool_alert,"['Dump Creds from memory', 'Builtin AV Client Heuristic', 'HackTool:Win32/DumpLsass']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'dumplsass'
  or ThreatFamily contains 'dumplsass'"
140,nanodump_pid_0001_av_hacktool_alert,"['MDE AV Client Heuristic', 'HackTool NanoDump']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'nanodump'
  or ThreatFamily contains 'nanodump'
"
141,atpminidump_pid_0003_av_hacktool_event,"['Builtin AV Client Heuristic', 'ATPMiniDump']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'AtpMiniDump'"
142,registryexfil_pid_0003_av_event,"['MDE AV Client Heuristic', 'Trojan RegistryExfil']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'registryexfil'"
143,atpminidump_pid_0001_av_hacktool_alert,"['Builtin AV Client Heuristic', 'ATPMiniDump']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'ATPMiniDump'
  or ThreatFamily contains 'ATPMiniDump'"
144,atpminidump_pid_0002_av_hacktool_dynamic,"['Builtin AV Client Heuristic', 'ATPMiniDump']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'AtpMiniDump'"
145,posdercan_pid_0003_av_trojan_event,"['Builtin AV Client Heuristic', 'Trojan PosderCan']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'posdercan'"
146,nanodump_pid_0003_av_hacktool_event,"['MDE AV Client Heuristic', 'Hacktool NanoDump']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'nanodump'"
147,dumplsass_pid_0003_av_hacktool_event,"['Dump Creds from memory', 'Builtin AV Client Heuristic', 'HackTool:Win32/DumpLsass']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'dumplsass'"
148,posdercan_pid_0002_av_trojan_dynamic,"['Builtin AV Client Heuristic', 'Trojan PosderCan']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'posdercan'"
149,malefic_pid_0002_av_pshell_dynamic,"['Builtin AV Client Heuristic', 'PowerShell Malefic Ams']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'maleficams'"
150,rundlllolbin_pid_0009_av_event,"['Builtin AV Client Heuristic', 'Trojan RundllLolBin']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'rundlllolbin'"
151,maleficams_pid_0003_av_pshell_event,"['Builtin AV Client Heuristic', 'PowerShell Malefic Ams']",single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'MaleficAms'"
152,dumplsass_pid_0002_av_hacktool_dynamic,"['Dump Creds from memory', 'Builtin AV Client Heuristic', 'HackTool:Win32/DumpLsass']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'dumplsass'"
153,dumpert_pid_0001_exe_or_dll,['Dump Creds from memory'],single_line_match,3,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'dumpert'
  or FileName has 'dumpert'"
154,gsecdump_pid_0002_dump_all_flag,"['Dump Creds from memory', 'Looks for common file name in File & CommandLine', 'dump all flag']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'gsecdump'
  or FileName has 'gsecdump'
| where ProcessCommandLine contains '-a'"
155,gsecdump_pid_0006_dump_flags_read_process_memory,"['Dump Creds from memory', 'Looks at Read Process Memory Api Call', 'Looks for -l, -a, -s flags', 'Coverage for renamed Gsecdump files']",['single_line_match'],1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['read_process_memory_api_call'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'ReadProcessMemoryApiCall'
  and InitiatingProcessCommandLine has_any('-a', '-l', '-s')
| extend TotalBytesCopied = parse_json(AdditionalFields).TotalBytesCopied
| where TotalBytesCopied >= 1000000
  and InitiatingProcessCommandLine !contains 'werfault'"
156,gsecdump_pid_0007_dump_flags_write_lsass_memory,"['Dump Creds from memory', 'Looks at Write To Lsass Process Memory', 'Looks for -l, -a, -s flags', 'Coverage for renamed Gsecdump files']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['write_to_lsass_process_memory'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'WriteToLsassProcessMemory'
  and InitiatingProcessCommandLine has_any('-a', '-l', '-s')"
157,gsecdump_pid_0004_dump_hashes_flag,"['Dump Creds from memory', 'Looks for common file name in File & CommandLine', 'dump hashes flag']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'gsecdump'
  or FileName has 'gsecdump'
| where ProcessCommandLine contains '-u'"
158,gsecdump_pid_0008_file_indicator,"['Dump Creds from memory', 'Looks at File events for common gsecdump file name']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],"['file_created', 'file_deleted', 'file_renamed', 'file_modified']",m365d_agent,m365d_security_center,,,m365d_security_center,device_file_events,,api_advanced_hunting,,,DeviceFileEvents,"| where FileName has 'gsecdump'
  or FileName startswith 'g64-'
  or InitiatingProcessFileName has 'gsecdump'"
159,builtin_pid_0010_av_hacktool_gsecdump_alert,"['Builtin AV Client Heuristic', 'Hacktool Gsecdump']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource !~ 'Custom detection'
| where Title contains 'gsecdump'
  or ThreatFamily contains 'gsecdump'"
160,gsecdump_pid_0001_dump_memory,"['Dump Creds from memory', 'Looks for common file name in File & CommandLine']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'gsecdump'
  or FileName has 'gsecdump'"
161,builtin_pid_0012_av_hacktool_gsecdump_event,"['Builtin AV Client Heuristic', 'Hacktool Gsecdump']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetectionActionType'
  and AdditionalFields contains 'gsecdump'"
162,gsecdump_pid_0004_dump_hashes_flag,"['Dump Creds from memory', 'Looks for common file name in File & CommandLine', 'dump hashes flag']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'gsecdump'
  or FileName has 'gsecdump'
| where ProcessCommandLine contains '-s'"
163,gsecdump_pid_0003_dump_lsa_flag,"['Dump Creds from memory', 'Looks for common file name in File & CommandLine', 'dump lsa flag']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'gsecdump'
  or FileName has 'gsecdump'
| where ProcessCommandLine contains '-l'"
164,builtin_pid_0011_av_hacktool_gsecdump_dynamic,"['Builtin AV Client Heuristic', 'Hacktool Gsecdump']",single_line_match,1,kql,[None],"['t1003', 's0008']",,['ref_gsecdump.md'],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'gsecdump'"
165,pypykatz_pid_0005_live_regdump,"['pypykatz live smb command', 'Dumps and parses the registry remotely over SMB.', ""Connection is set up using the current user's context."", 'registry hive files will be deleted after command finishes (best effort)']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('live', 'smb', 'regdump')"
166,pypykatz_pid_0001_live_lsa,"['pypykatz lsass dump commands', 'Obtains the credentials stored in the LSASS.exe process.']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('live', 'lsa')"
167,pypykatz_pid_0010_av_hacktool_event,"['MDE AV Client Heuristic', 'Hacktool Pypykatz']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'pypykatz'"
168,pypykatz_pid_0005_live_lsassdump,"['pypykatz live smb command', 'Enumerates shares, folders, files on the target(s) over SMB.']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('live', 'smb', 'lsassdump')"
169,pypykatz_pid_0009_av_hacktool_dynamic,"['MDE AV Client Heuristic', 'Hacktool Pypykatz']",['single_line_match'],1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'pypykatz'"
170,pypykatz_pid_0004_live_secretsdump,"['pypykatz live smb command', 'performs lsassdump, regdump and dcsync']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('live', 'smb', 'secretsdump')"
171,pypykatz_pid_0003_live_registry,"['pypykatz dcsynce attack', 'Performs DCSYNC attack, extracts all hashes and kerberos keys from the domain controller using DRSUAPI']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('live', 'smb', 'dcsync')"
172,pypykatz_pid_0005_live_dump_file,"['pypykatz live smb command', 'Live command dumped to file']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'live'
  and ProcessCommandLine has_any('lsa', 'registry')
  and ProcessCommandLine has_any ('-o', '--json')
| where ProcessCommandLine contains 'live lsa'
  or ProcessCommandLine contains 'live registry'"
173,pypykatz_pid_0008_av_hacktool_alert,"['MDE AV Client Heuristic', 'HackTool Pypykatz']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource !~ 'Custom detection'
| where Title contains 'Pypykatz'
  or ThreatFamily contains 'Pypykatz'
"
174,pypykatz_pid_0002_live_registry,"['pypykatz dump sam or secrets files', 'Obtains the credentials / secrets / other info from live registry']",single_line_match,1,kql,[None],['t1003'],,['ref_pypykatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('live', 'registry')
  and ProcessCommandLine contains ('live registry')"
175,certutil_pid_0001_vss,['Certutil used to create encoded volume shadow copy'],single_line_match,2,kql,[None],['t1003'],,['ref_certutil.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('certutil', 'HarddiskVolumeShadowCopy')"
176,mshta_pid_0010_rare_file_execution,['mshta executing a rare file extension'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mshta'
  or ProcessVersionInfoOriginalFileName has 'mshta'
| where ProcessCommandLine has_any ('doc', 'xls', 'lnk', 'png', 'zip', 'jpg', 'bat')
"
177,mshta_pid_0002_executing_vbs,['mshta executing VBS files'],single_line_match,3,kql,[None],['t1218'],,[None],"['mshta vbscript:Execute(""CreateObject(""""Wscript.Shell"""").Run """"powershell -noexit -file <filepath>"""":close"")']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mshta'
  or ProcessVersionInfoOriginalFileName has 'mshta'
| where ProcessCommandLine has_all ('vbscript', 'execute')
  and ProcessCommandLine has_any  ('script', 'run', 'wscript')"
178,mshta_pid_0008_rare_process_spawn,"['mshta spawning a rare process', 'maybe result of suspicious HTA']",single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where InitiatingProcessFileName has 'mshta'
  or InitiatingProcessVersionInfoOriginalFileName has 'mshta'
| where FileName has_any ('cscript', 'wscript', 'powershell', 'pwsh', 'regsvr', 'reg', 'bitsadmin')
"
179,mshta_pid_0009_rare_cmd_spawn,"['mshta spawning cmd shell', 'maybe result of suspicious HTA']",single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where InitiatingProcessFileName has 'mshta'
  or InitiatingProcessVersionInfoOriginalFileName has 'mshta'
| where FileName has 'cmd'
"
180,mshta_pid_0004_executing_remote_file,['mshta executing remote file'],single_line_match,3,kql,[None],['t1218'],,[None],['mshta (http:// or https://) filename.hta'],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mshta'
  or ProcessVersionInfoOriginalFileName has 'mshta'
| where ProcessCommandLine has_any ('http', 'https', 'ftp')
"
181,mshta_pid_0006_rare_execution_folder,"['mshta executing a file into or from a rare folder path', 'mshta executing a file into or from a folder path commonly abused by threat actors']",single_line_match,3,kql,[None],['t1218'],,[None],['mshta (http:// or https://) filename.hta'],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mshta'
  or ProcessVersionInfoOriginalFileName has 'mshta'
| where ProcessCommandLine contains @'\AppData\Local\'
  or ProcessCommandLine contains @'\Users\Public\'
  or ProcessCommandLine contains @'\Windows\Temp\'
  or ProcessCommandLine contains @'\ProgramData\'
"
182,mshta_pid_0001_executing_hta,['mshta executing HTA files'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mshta'
  or ProcessVersionInfoOriginalFileName has 'mshta'
| where ProcessCommandLine contains '.hta'"
183,mshta_pid_0007_lethal_hta,['mshta spawned by svchost LethalHTA'],single_line_match,3,kql,[None],['t1218'],,[None],['mshta (http:// or https://) filename.hta'],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mshta'
  or ProcessVersionInfoOriginalFileName has 'mshta'
| where InitiatingProcessFileName has 'svchost'
"
184,mshta_pid_0003_executing_javascript,['mshta executing javascript files'],single_line_match,3,kql,[None],['t1218'],,[None],"[""mshta.exe javascript:a=(GetObject('script:#{file_url}')).Exec();close();""]",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mshta'
  or ProcessVersionInfoOriginalFileName has 'mshta'
| where ProcessCommandLine has_all ('javascript', 'GetObject', 'script')
"
185,mshta_pid_0005_rare_parent,['mshta being spawned by a rare initiating/parent file'],single_line_match,3,kql,[None],['t1218'],,[None],['mshta (http:// or https://) filename.hta'],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mshta'
  or ProcessVersionInfoOriginalFileName has 'mshta'
| where InitiatingProcessFileName has_any ('cmd', 'cscript', 'wscript', 'pwsh', 'powershell', 'regsvr', 'rundll')
"
186,msdt_pid_0001_follina_rce_exploit,['MSDT Follina CVE-2022-30190'],single_line_match,2,kql,[None],['t1218'],,[None],"['msdt /id PCWDiagnostic /skip force /param ""IT_LaunchMethod=ContextMenu IT_BrowseForFile=/../../$(calc).exe""']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('msdt', 'PCWDiagnostic')
| where ProcessCommandLine contains 'IT_BrowseForFile='
  and ProcessCommandLine contains '../../'"
187,msdt_pid_0002_fpcwdiag_executing_xml,['MSDT executing a xml file'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('msdt', 'PCWDiagnostic')
  and InitiatingProcessFileName !has 'pcwrun'
| where ProcessCommandLine contains '-af'
  and ProcessCommandLine contains '.xml'"
188,powerview_pid_0001_get_ad_enum_modules.yaml,"['powerview', 'ad enumeration get- modules']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'get'
  and ProcessCommandLine has_any ('NetDomain', 'NetForest', 'NetForestDomain', 'NetDomainController', 
    'NetGroupMember', 'NetLoggedon', 'NetDomainTrust', 'NetForestTrust', 'NetProcess', 'DomainTrust', 
    'DomainTrustMapping', 'DomainController', 'ForestDomain')
"
189,powersploit_pid_0005_get_exfil_modules,"['powersploit', 'get exfiltration module']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'get'
  and ProcessCommandLine has_any ('Keystrokes', 'GPPPassword', 'GPPAutoLogon', 'TimedScreenshot', 
    'VaultCredential', 'VolumeShadowCopy', 'MicrophoneAudio')
"
190,mppreference_pid_0002_set_dbm,"['Disable Defender Service with PowerShell', 'Set-MpPreference', 'DisableBehaviorMonitoring']",single_line_match,2,kql,[None],['t1562'],,[None],"['Set-MpPreference -DisableBehaviorMonitoring 1', 'Set-MpPreference -dbm $True']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'powershell'
  and ProcessCommandLine has_all ('Set', 'MpPreference')
  and ProcessCommandLine has_any ('-DisableBehaviorMonitoring', '-dbm')
| where ProcessCommandLine has_any ('1', 'true')"
191,powerview_pid_0005_edr_script_detected.yaml,"['MDE EDR Behavior Alert', 'PowerView script detect']",single_line_match,1,kql,[None],[None],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'PowerView script detected'
192,powerview_pid_0010_get_domain_trust_modules,"['powerview', 'Get Modules']",single_line_match,2,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'get'
  and ProcessCommandLine has_any ('DomainTrust', 'ForestTrust', 'DomainForeignUser', 'DomainForeignGroupMember', 
  'DomainTrustMapping')
"
193,powerdump_pid_0001_pshell_invoke,"['dumping hashes from a Windows System', 'powershell script']",single_line_match,1,kql,[None],['t1003'],,['ref_powerdump.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has_all ('invoke', 'powerdump')
  or InitiatingProcessCommandLine has_all ('invoke', 'powerdump')"
194,powersploit_pid_0006_get_exfil_modules,"['powersploit', 'get exfil modules']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has ('invoke')
  or InitiatingProcessCommandLine has ('invoke')
| where AdditionalFields has_any ('Keystrokes', 'GPPPassword', 'GPPAutoLogon', 'TimedScreenshot', 
    'VaultCredential', 'VolumeShadowCopy', 'MicrophoneAudio')
  or InitiatingProcessCommandLine has_any ('Keystrokes', 'GPPPassword', 'GPPAutoLogon', 'TimedScreenshot', 
    'VaultCredential', 'VolumeShadowCopy', 'MicrophoneAudio')"
195,powerview_pid_0011_get_domain_trust_modules,"['powerview', 'get Modules']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has ('Invoke')
  or InitiatingProcessCommandLine has ('Invoke')
| where AdditionalFields has_any ('DomainTrust', 'ForestTrust', 'DomainForeignUser', 'DomainForeignGroupMember', 
    'DomainTrustMapping')
  or InitiatingProcessCommandLine has_any ('DomainTrust', 'ForestTrust', 'DomainForeignUser', 
    'DomainForeignGroupMember', 'DomainTrustMapping')"
196,dsinternals_pid_0001_get_adreplaccount,['DSInternals Get-ADReplAccount'],single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,| where ProcessCommandLine has 'ADReplAccount'
197,powerview_pid_0004_invoke_kerberoast_module,"['powerview', 'invoke kerberoast']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has_all ('invoke', 'kerberoast')
  or InitiatingProcessCommandLine has_all ('invoke', 'kerberoast')"
198,powersploit_pid_0003_invoke_exfil_modules,"['powersploit', 'invoke exfiltration module']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'invoke'
  and ProcessCommandLine has_any ('TokenManipulation', 'CredentialInjection', 'NinjaCopy')
"
199,powerdump_pid_0002_pshell_cmd,"['dumping hashes from a Windows System', 'powershell script', 'matches on common pshell commands']",aggregate_multiline_match,1,kql,[None],['t1003'],,['ref_powerdump.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,"let PowerDumpDevice = materialize(DeviceEvents | where ActionType =~ ""PowershellCommand""
| where AdditionalFields has_any ('elevateprivs', 'userhashes', 'dumphashes', 'bootkey', 'decrypthashes')
| distinct DeviceId);
",DeviceEvents,"| where ActionType =~ ""PowershellCommand""
  and DeviceId in (PowerDumpDevice)
| extend Pshell = parse_json(AdditionalFields).Command
| summarize PshellSet=make_set(Pshell), arg_max(Timestamp, *) by DeviceName, bin(Timestamp, 1h)
| where PshellSet has_all(@'get-childitem', 'ElevatePrivs', @'get-process', @'get-userhashes', 'dumphashes', @'get-bootkey', 'decrypthashes')"
200,powerview_pid_0006_get_ldap_modules,"['powerview', 'Domain/LDAP Modules']",single_line_match,2,kql,[None],['t1059'],,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'get'
  and ProcessCommandLine has_any ('DomainDNSZone', 'DomainDNSRecord', 'Domain', 'DomainController'
    'Forest', 'ForestDomain', 'ForestGlobalCatalog', 'DomainUser', 'DomainUserEvent', 'DomainComputer', 
    'DomainObject', 'DomainObjectAcl', 'DomainOU', 'DomainSite', 'DomainSubnet', 'DomainSID', 'DomainGroup'
    'DomainManagedSecurityGroup', 'DomainGroupMember', 'DomainFileServer', 'DomainDFSShare')
"
201,powersploit_pid_0007_out_minidump_module,"['powersploit', 'out minidump module']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('out', 'minidump')
"
202,powersploit_pid_0002_invoke_code_execution_modules,"['powersploit', 'invoke code execution module']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has ('invoke')
  or InitiatingProcessCommandLine has ('invoke')
| where AdditionalFields has_any ('TokenManipulation', 'CredentialInjection', 'NinjaCopy')
  or InitiatingProcessCommandLine has_any ('TokenManipulation', 'CredentialInjection', 'NinjaCopy')"
203,powerview_pid_0003_invoke_kerberoast_module,"['powerview', 'invoke kerberoast']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('invoke', 'kerberoast')
"
204,mppreference_pid_0004_set_dbaf,"['Disable Defender Service with PowerShell', 'Set-MpPreference', 'DisableBlockAtFirstSeen']",single_line_match,2,kql,[None],['t1562'],,[None],"['Set-MpPreference -DisableBlockAtFirstSeen 1', 'Set-MpPreference -dbaf $True']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'powershell'
  ProcessCommandLine has_all ('Set', 'MpPreference')
  and ProcessCommandLine has_any ('-DisableBlockAtFirstSeen', '-dbaf')
| where ProcessCommandLine has_any ('1', 'true')"
205,mppreference_pid_0001_set_drtm,"['Disable Defender Service with PowerShell', 'Set-MpPreference', 'DisableRealtimeMonitoring']",single_line_match,2,kql,[None],['t1562'],,[None],"['Set-MpPreference -DisableRealtimeMonitoring 1', 'Set-MpPreference -drtm $True']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'powershell'
  and ProcessCommandLine has_all ('Set', 'MpPreference')
  and ProcessCommandLine has_any ('-DisableRealtimeMonitoring', '-dtrm')
| where ProcessCommandLine has_any ('1', 'true')"
206,powersploit_pid_0002_invoke_code_execution_modules,"['powersploit', 'invoke code execution module']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has ('invoke')
  or InitiatingProcessCommandLine has ('invoke')
| where AdditionalFields has_any ('Dllinjection', 'ReflectivePEInjection', 'Shellcode', 'WmiCommand')
  or InitiatingProcessCommandLine has_any ('Dllinjection', 'ReflectivePEInjection', 'Shellcode', 'WmiCommand')"
207,mppreference_pid_0003_set_dscrptsc.yaml,"['Disable Defender Service with PowerShell', 'Set-MpPreference', 'DisableScriptScanning']",single_line_match,2,kql,[None],['t1562'],,[None],"['Set-MpPreference -DisableScriptScanning 1', 'Set-MpPreference -dscrptsc $True']",['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'powershell'
  and ProcessCommandLine has_all ('Set', 'MpPreference')
  and ProcessCommandLine has_any ('-DisableScriptScanning', '-dscrptsc')
| where ProcessCommandLine has_any ('1', 'true')"
208,powerview_pid_0009_invoked_modules,"['powerview', 'Invoke Modules']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has ('Invoke')
  or InitiatingProcessCommandLine has ('Invoke')
| where AdditionalFields has_any ('UserImpersontation', 'RevertToSelf', 'Kerberoast')
  or InitiatingProcessCommandLine has_any ('UserImpersontation', 'RevertToSelf', 'Kerberoast')"
209,powersploit_pid_0001_invoke_code_execution_modules,"['powersploit', 'invoke code execution module']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'invoke'
  and ProcessCommandLine has_any ('Dllinjection', 'ReflectivePEInjection', 'Shellcode', 'WmiCommand')
"
210,powerview_pid_0002_get_ad_enum_modules,"['powerview', 'ad enumeration get- modules']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has ('get')
  or InitiatingProcessCommandLine has ('get')
| where AdditionalFields has_any ('NetDomain', 'NetForest', 'NetForestDomain', 'NetDomainController', 
    'NetGroupMember', 'NetLoggedon', 'NetDomainTrust', 'NetForestTrust', 'NetProcess', 'DomainTrust', 
    'DomainTrustMapping', 'DomainController', 'ForestDomain')
  or InitiatingProcessCommandLine has_any ('NetDomain', 'NetForest', 'NetForestDomain', 'NetDomainController', 
    'NetGroupMember', 'NetLoggedon', 'NetDomainTrust', 'NetForestTrust', 'NetProcess', 'DomainTrust', 
    'DomainTrustMapping', 'DomainController', 'ForestDomain')"
211,powerview_pid_0007_get_ldap_modules,"['powerview', 'LDAP/Domain Get- Modules']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has ('get')
  or InitiatingProcessCommandLine has ('get')
| where AdditionalFields has_any ('DomainDNSZone', 'DomainDNSRecord', 'Domain', 'DomainController'
    'Forest', 'ForestDomain', 'ForestGlobalCatalog', 'DomainUser', 'DomainUserEvent', 'DomainComputer', 
    'DomainObject', 'DomainObjectAcl', 'DomainOU', 'DomainSite', 'DomainSubnet', 'DomainSID', 'DomainGroup'
    'DomainManagedSecurityGroup', 'DomainGroupMember', 'DomainFileServer', 'DomainDFSShare')
  or InitiatingProcessCommandLine has_any ('DomainDNSZone', 'DomainDNSRecord', 'Domain', 'DomainController'
    'Forest', 'ForestDomain', 'ForestGlobalCatalog', 'DomainUser', 'DomainUserEvent', 'DomainComputer', 
    'DomainObject', 'DomainObjectAcl', 'DomainOU', 'DomainSite', 'DomainSubnet', 'DomainSID', 'DomainGroup'
    'DomainManagedSecurityGroup', 'DomainGroupMember', 'DomainFileServer', 'DomainDFSShare')"
212,powersploit_pid_0008_out_minidump_module,"['powersploit', 'out minidump module']",single_line_match,1,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['powershell_command'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'PowerShellCommand'
| where AdditionalFields has_all ('out', 'minidump')
  or InitiatingProcessCommandLine has_all ('out', 'minidump')"
213,powerview_pid_0008_invoke_modules,"['powerview', 'Invoke Modules']",single_line_match,2,kql,[None],"['t1059', 's0194']",,['ref_powersploit_powerview.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'Invoke'
  and ProcessCommandLine has_any ('UserImpersonation', 'RevertToSelf', 'Kerberoast')
"
214,adfind_pid_0006_edr_uncommon_tool_launch,"['MDE EDR Behavior Alert', 'Uncommon Adfind Tool Launch']",single_line_match,1,kql,[None],['s0552'],,['ref_adfind.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Uncommon Adfind tool launch'
215,adfind_pid_0005_av_hacktool_event,"['Builtin AV Client Heuristic', 'Adfind HackTool']",single_line_match,1,kql,[None],['s0552'],,[None],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'ADFind'
  or ThreatFamily contains 'ADFind'"
216,aadfind_pid_0007_edr_collecting_ad_info,"['MDE EDR Behavior Alert', 'Uncommon Adfind Tool Launch']",single_line_match,1,kql,[None],['s0552'],,['ref_adfind.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,| where Title =~ 'Adfind tool collecting Active Directory information'
217,atpminidump_pid_0003_av_hacktool_event,"['Builtin AV Client Heuristic', 'Adfind HackTool']",single_line_match,,kql,[None],['s0552'],,[None],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'ADfind'"
218,adfind_pid_0004_av_hacktool_dynamic.yaml,"['Builtin AV Client Heuristic', 'Adfind HackTool']",single_line_match,,kql,[None],['s0552'],,[None],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'Adfind'"
219,adfind_pid_0001_domain_trust,['Adfind domain trust'],single_line_match,2,kql,[None],"['s0552', 't1482']",,['ref_adfind.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('adfind', 'trustdmp')
  and ProcessCommandLine has_any ('-sc', '-gcb', '-gc')"
220,adfind_pid_0002_organizational_unit,['Adfind object cateory organizational unit'],single_line_match,2,kql,[None],"['s0552', 't1482']",,['ref_adfind.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('adfind', 'objectcategory', 'organizationalunit')"
221,appinstaller_pid_0002_load_remote_package.yaml,"['AppInstaller.exe is spawned by the default handler for the URI', 'it attempts to load/install a package from the URL and is saved in INetCache']",single_line_match,3,kql,[None],['t1105'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('start', 'appinstaller')
| where ProcessCommandLine contains 'http'
  and ProcessCommandLine contains 'ms-appinstaller'"
222,appinstaller_pid_0001_handler_invoked_netcon,"['AppInstaller.exe is spawned by the default handler for the URI', 'it attempts to load/install a package from the URL and is saved in INetCache']",single_line_match,3,kql,[None],['t1105'],,[None],[None],['windows_os'],['connection_all'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceNetworkEvents,"| where InitiatingProcessFileName has 'appinstaller'
| where RemoteUrl contains 'https:'
  or RemoteUrl contains 'http:'"
223,dsquery_pid_0001_domain_trust,['Copy the SAM Hive using the esentutl Utility and Shadowcopy'],single_line_match,1,kql,[None],['t1482'],,['ref_dsquery.md'],[None],"['windows_os_domain_controller', 'windows_os']",['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('filter', 'objectclass', 'trusteddomain', 'dsquery')"
224,netsh_pid_0012_port_proxy,['netsh used to set up port forwarding port proxy'],single_line_match,3,kql,[None],"['t1090', 's0108']",,[None],['netsh interface portproxy add v4tov4 listenport=8001 listenaddress=<JUMP BOX IP> connectport=3389 connectaddress=<DESTINATION IP>'],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('portproxy', 'add')
  and ProcessCommandLine contains 'v4tov4'"
225,netsh_pid_0006_add_fw_rule,['add a local firewall rule name'],single_line_match,3,kql,[None],"['t1562', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('advfirewall', 'add', 'rule', 'name')"
226,netsh_pid_0011_port_forwarding_rdp,['netsh used to set up port forwarding for rdp'],single_line_match,3,kql,[None],"['t1090', 's0108']",,[None],['netsh I p a v l=8001 listena=<JUMP BOX IP> connectp=3389 c=<DESTINATION IP>'],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('listena', 'connectp')
  and ProcessCommandLine contains 'c=3389'
| where ProcessCommandLine contains ' i '
  and ProcessCommandLine contains ' p '
  and ProcessCommandLine contains ' a '
  and ProcessCommandLine contains ' v '"
227,netsh_pid_0001_set_fw_profile_off,['Netsh Setting Firewall profile to off'],single_line_match,3,kql,[None],"['t1562', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('advfirewall', 'set', 'state', 'off')
| where ProcessCommandLine has_any ('allprofiles', 'Currentprofile', 'Domainprofile', 'Privateprofile', 'Publciprofile')"
228,netsh_pid_0009_helper_dll,"['netsh used to register helper dll', 'persistence method']",single_line_match,3,kql,[None],"['t1546', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('add', 'helper')"
229,netsh_pid_0003_masquerading,['Netsh disable windows firewall'],single_line_match,3,kql,[None],"['t1036', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName !has 'netsh'
  and ProcessVersionInfoOriginalFileName has 'netsh'
| where isnotempty(ProcessVersionInfoOriginalFileName)"
230,netsh_pid_0010_port_forwarding,['netsh used to set up port forwarding'],single_line_match,3,kql,[None],"['t1090', 's0108']",,[None],['netsh I p a v l=8001 listena=127.0.0.1 connectp=80 c=192.168.1.1'],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('listena', 'connectp')
  and ProcessCommandLine contains 'c='
| where ProcessCommandLine contains ' i '
  and ProcessCommandLine contains ' p '
  and ProcessCommandLine contains ' a '
  and ProcessCommandLine contains ' v '"
231,netsh_pid_0005_modify_fw_smb_enable,['enables print file share feature (smb) on windows by modifying firewall rules'],single_line_match,3,kql,[None],"['t1562', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('advfirewall', 'set', 'rule', 'group', 'file', 'printer', 'enable' ,'yes')"
232,netsh_pid_0008_show_fw_rules,['netsh used to list firewall rules'],single_line_match,3,kql,[None],"['t1016', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('advfirewall', 'show', 'rule')"
233,netsh_pid_0004_modify_fw_rdp_enable,['netsh enables remote desktop feature on windows by modifying firewall rules'],single_line_match,3,kql,[None],"['t1562', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('advfirewall', 'set', 'rule', 'group', 'remote', 'desktop', 'enable' ,'yes')"
234,netsh_pid_0002_disable_windows_fw,['Netsh disable windows firewall'],single_line_match,3,kql,[None],"['t1562', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('netsh', 'firewall', 'set', 'opmode', 'disable')"
235,netsh_pid_0006_add_fw_rule_rdp,['add a local firewall rule for RDP'],single_line_match,3,kql,[None],"['t1562', 's0108']",,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'netsh'
| where ProcessCommandLine has_all ('advfirewall', 'add', 'rule', 'name')
| where ProcessCommandLine has_all ('remote', 'desktop')
  or ProcessCommandLine contains '3389'
"
236,rpcping_pid_0001_ntlm_hash,"['RpcPing command can be used to send an RPC test connection to the target server (-s)', 'Force the NTLM hash to be sent in the process.']",single_line_match,2,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('rpcping', '-s', 'ntlm')"
237,kekeo_pid_0003_tgs,['kekeo command indicators'],single_line_match,1,kql,[None],['t1558'],,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'tgs'
  and ProcessCommandLine contains 'tgs::'"
238,builtin_pid_0021_av_hacktool_mimikatz_dynamic,"['MDE AV Client Heuristic', 'Hacktool Mimikatz']",['single_line_match'],1,kql,[None],"['t1003', 's0003']",,['ref_mimikatz.md'],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'mimikatz'"
239,rubeus_pid_0002_kerberoast,['rubeus indicators'],single_line_match,1,kql,[None],"['t1558', 's1071']",,['ref_kekeo.md'],[None],['windows_os'],['ldap_search'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'LdapSearch'
  and InitiatingProcessCommandLine has 'kerberoast'"
240,kekeo_pid_0001_tsssp,['kekeo command indicators'],single_line_match,1,kql,[None],['t1558'],,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'smb'
  and ProcessCommandLine contains 'smb::'"
241,kekeo_pid_0004_ntlm,['kekeo command indicators'],single_line_match,1,kql,[None],['t1558'],,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'ntlm'
  and ProcessCommandLine contains 'ntlm::'"
242,kekeo_pid_0002_tgt,['kekeo command indicators'],single_line_match,1,kql,[None],['t1558'],,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'tgt'
  and ProcessCommandLine contains 'tgt::'"
243,kekeo_pid_0008_misc,['kekeo command indicators'],single_line_match,1,kql,[None],['t1558'],,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'misc'
  and ProcessCommandLine contains 'misc::'"
244,builtin_pid_0020_av_hacktool_mimikatz_alert,"['MDE AV Client Heuristic', 'VirTool Kekeo']",single_line_match,1,kql,[None],"['t1558', 's1071']",,['ref_kekeo.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'Kekeo'
  or ThreatFamily contains 'Kekeo'
"
245,rubeus_pid_0001_kerberoast,['rubeus indicators'],single_line_match,1,kql,[None],"['t1558', 's1071']",,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,| where ProcessCommandLine has 'kerberoast'
246,kekeo_pid_0005_kerberos,['kekeo command indicators'],single_line_match,1,kql,[None],['t1558'],,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'kerberos'
  and ProcessCommandLine contains 'kerberos::'"
247,kekeo_pid_0007_exploit,['kekeo command indicators'],single_line_match,1,kql,[None],['t1558'],,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'exploit'
  and ProcessCommandLine contains 'exploit::'"
248,kekeo_pid_0001_tsssp,['kekeo command indicators'],single_line_match,1,kql,[None],['t1558'],,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'tsssp'
  and ProcessCommandLine contains 'tsssp::'"
249,rubeus_pid_0004_asreproast,['rubeus indicators'],single_line_match,1,kql,[None],"['t1558', 's1071']",,['ref_kekeo.md'],[None],['windows_os'],['ldap_search'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'LdapSearch'
  and InitiatingProcessCommandLine has 'asreproast'"
250,builtin_pid_0022_av_hacktool_mimikatz_event,"['MDE AV Client Heuristic', 'Hacktool Mimikatz']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'mimikatz'"
251,rubeus_pid_0003_asreproast,['rubeus indicators'],single_line_match,1,kql,[None],"['t1558', 's1071']",,['ref_kekeo.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,| where ProcessCommandLine has 'asreproast'
252,rdrleakdiag_pid_0001_memory_dump,['Rdrleakdiag.exe used to dump memory'],single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('rdrleakdiag', '/p', '/o')
  and ProcessCommandLine has_any ('lsass', 'fullmemdmp' 'minidump')"
253,mimikatz_pid_0003_privilege,"['mimikatz command indicator', 'This module provides some functionalities to manipulate privileges on mimikatz process']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'privilege'
  and ProcessCommandLine contains 'privilege::'"
254,builtin_pid_0022_av_hacktool_mimikatz_event,"['MDE AV Client Heuristic', 'Hacktool Mimikatz']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['antivirus_detection'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType startswith 'AntivirusDetection'
  and AdditionalFields contains 'mimikatz'"
255,mimikatz_pid_0002_lsadump,"['mimikatz command indicator', 'refer to command documentation for further description']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'lsadump'
  and ProcessCommandLine contains 'lsadump::'"
256,mimikatz_pid_0001_sekurlsa,"['mimikatz command indicator', 'This modules is probably the most used one among Mimikatz users.', 'It retrieves clear text passwords, kerberos tickets, pin codes, etc', 'Creds from LSA Subsystem Service (LSASS)', 'Refer to command documention for further descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'sekurlsa'
  and ProcessCommandLine contains 'sekurlsa::'"
257,mimikatz_pid_0010_rpc,"['mimikatz command indicator', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'rpc'
  and ProcessCommandLine contains 'rpc::'"
258,builtin_pid_0020_av_hacktool_mimikatz_alert,"['MDE AV Client Heuristic', 'Hacktool Mimikatz']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['alert_evidence'],m365d_agent,m365d_security_center,,,m365d_security_center,alert_evidence,,api_advanced_hunting,,,AlertEvidence,"| where DetectionSource =~ 'Antivirus'
| where Title contains 'mimikatz'
  or ThreatFamily contains 'mimikatz'
"
259,mimikatz_pid_0007_vault,"['mimikatz command indicator', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'vault'
  and ProcessCommandLine contains 'vault::'"
260,mimikatz_pid_0011_event,"['mimikatz command indicator', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'event'
  and ProcessCommandLine contains 'event::'"
261,mimikatz_pid_0013_token,"['mimikatz command indicator', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'token'
  and ProcessCommandLine contains 'token::'"
262,mimikatz_pid_0006_dpapi,"['mimikatz command indicator', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'dpapi'
  and ProcessCommandLine contains 'dpapi::'"
263,mimikatz_pid_0005_crypto,"['mimikatz command indicator', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'crypto'
  and ProcessCommandLine contains 'crypto::'"
264,builtin_pid_0021_av_hacktool_mimikatz_dynamic,"['MDE AV Client Heuristic', 'Hacktool Mimikatz']",['single_line_match'],1,kql,[None],"['t1003', 's0003']",,['ref_mimikatz.md'],[None],['windows_os'],['other_alert_related_activity'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'OtherAlertRelatedActivity'
  and AdditionalFields contains 'mimikatz'"
265,mimikatz_pid_0012_invoke,"['mimikatz command indicator', 'see command documentation for more descriptions', 'powershell invoke mimikatz']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'invoke'
  and ProcessCommandLine has_any ('mimikatz', 'Dumpcreds')"
266,mimikatz_pid_0008_process,"['mimikatz command indicator', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'process'
  and ProcessCommandLine contains 'process::'"
267,mimikatz_pid_0004_kerberos,"['mimikatz command indicator', 'can be used to forge tickets', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'kerberos'
  and ProcessCommandLine contains 'kerberos::'"
268,mimikatz_pid_0009_misc,"['mimikatz command indicator', 'see command documentation for more descriptions']",single_line_match,1,kql,[None],"['t1003', 's0002']",,['ref_mimikatz.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'misc'
  and ProcessCommandLine contains 'misc::'"
269,lsass_pid_0003_large_memory_read,"['Large Memory Read 20 Mega Bytes', 'Rare File or Process', 'Rare is seen on 5 or less machines in time period']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['read_process_memory_api_call'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'ReadProcessMemoryApiCall'
  and FileName has 'lsass'
  and parse_json(AdditionalFields).TotalBytesCopied > 20000000
"
270,lsass_pid_0008_run_not_system,['Lsass Run from a Non System Account'],single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['process_create'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'lsass.exe'
  and AccountName !~ 'system'"
271,lsass_pid_0011_registry_image_file_exe_opt,['Shtinkering LSASS'],single_line_match,1,kql,[None],['t1562'],,"['ref_registry.md', 'ref_lsass.md']",[None],['windows_os'],['registry_event'],m365d_agent,m365d_security_center,,,m365d_security_center,device_registry_events,,api_advanced_hunting,,,DeviceRegistryEvents,"| where RegistryKey has_all ('software', 'Image', 'Lsass', 'File', 'Execution')
  and RegistryKey has_any ('HKLM', 'HKEY_LOCAL_MACHINE')
  and RegistryKey contains 'Image File Execution Options'"
272,lsass_pid_0009_shtinkering,"['Lsass.exe Dump File Created', 'Potential shtinkering', 'Might be from werfault.exe']",single_line_match,2,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['file_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_file_events,,api_advanced_hunting,,,DeviceFileEvents,"| where FileName has_all ('lsass', 'dmp')
  and ActionType =~ 'FileCreated'"
273,lsass_pid_0007_dump_file_commandline,['Lsass.dmp Indicator in CommandLine'],single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_file_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('lsass', 'dmp')
  or ProcessCommandLine contains 'lsass.dmp'"
274,lsass_pid_0007_pshell_get_process_id,['Powershell Used to get Lsass Process Id'],single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['process_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('Get', 'Process' , 'lsass')
  and ProcessCommandLine contains 'Get-Process'"
275,lsass_pid_0004_rundll_large_memory_read,"['Rundll Initiated Large Lsass Read', 'Potential Cred Dump']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['read_process_memory_api_call'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'ReadProcessMemoryApiCall'
  and FileName =~ 'lsass.exe'
  and InitiatingProcessFileName contains 'rundll'
  and parse_json(AdditionalFields).TotalBytesCopied >= 20000000"
276,lsass_pid_0005_taskmgr_large_memory_read,"['Task Manager Initiated Large Lsass Read', 'Potential Cred Dump']",single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['read_process_memory_api_call'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'ReadProcessMemoryApiCall'
  and FileName =~ 'lsass.exe'
  and InitiatingProcessFileName contains 'rundll'
  and parse_json(AdditionalFields).TotalBytesCopied >= 20000000"
277,lsass_pid_0010_registry_silent_process_exit,['Shtinkering LSASS'],single_line_match,1,kql,[None],['t1562'],,"['ref_registry.md', 'ref_lsass.md']",[None],['windows_os'],['registry_event'],m365d_agent,m365d_security_center,,,m365d_security_center,device_registry_events,,api_advanced_hunting,,,DeviceRegistryEvents,"| where RegistryKey has_all ('software', 'SilentProcessExit', 'Lsass')
  and RegistryKey has_any ('HKLM', 'HKEY_LOCAL_MACHINE')"
278,lsass_pid_0006_dump_file_created,['Lsass Dump File Created'],single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['file_created'],m365d_agent,m365d_security_center,,,m365d_security_center,device_file_events,,api_advanced_hunting,,,DeviceFileEvents,"| where ActionType =~ 'FileCreated'
  and FileName has_all ('lsass', 'dmp')"
279,lsass_pid_0002_memory_read_not_system,['Lsass Read from a Non System Account'],single_line_match,1,kql,[None],['t1003'],,['ref_lsass.md'],[None],['windows_os'],['read_process_memory_api_call'],m365d_agent,m365d_security_center,,,m365d_security_center,device_events,,api_advanced_hunting,,,DeviceEvents,"| where ActionType =~ 'ReadProcessMemoryApiCall'
  and FileName =~ 'lsass.exe'
  and AccountName !~ 'system'"
280,hh_pid_0002_executing_chm,['open .CHM compiled HTML files with HH.exe HTML help'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'hh.exe'
  or ProcessVersionInfoOriginalFileName =~ 'hh.exe'
| where ProcessCommandLine contains '.chm'"
281,hh_pid_0003_executing_remote_file,['HTML help executing remote file'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'hh.exe'
  or ProcessVersionInfoOriginalFileName =~ 'hh.exe'
| where ProcessCommandLine contains 'http://'
  or ProcessCommandLine contains 'https://'"
282,hh_pid_0005_parent_powershell,['HTML help called powershell'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'hh.exe'
  or ProcessVersionInfoOriginalFileName =~ 'hh.exe'
| where InitiatingProcessVersionInfoOriginalFileName has 'powershell'"
283,hh_pid_0001_executing_pshell_script,['open powershell script with HTML help'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'hh.exe'
  or ProcessVersionInfoOriginalFileName =~ 'hh.exe'
| where ProcessCommandLine contains '.ps1'"
284,hh_pid_0004_decompiling_file,['HTML help decompiling file'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName =~ 'hh.exe'
  or ProcessVersionInfoOriginalFileName =~ 'hh.exe'
| where ProcessCommandLine contains '-decompile'"
285,regt1003_pid_0001_save_sam,"['reg.exe used to save SAM file for potential enumeration', 'Also for offline cred dumping attack']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\sam', @'HKEY_LOCAL_MACHINE\sam')
  and ProcessCommandLine has_any('save', 'export')"
286,regt1562_pid_0001_netntlm_downgrade_restrict_sending_ntlm_traffic,"['Registry Modification of Key HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0', 'Property = RestrictSendingNTLMTraffic', 'Setting to 0 disables']",single_line_match,1,kql,[None],['t1562'],,"['ref_registry.md', 'ref_registry_t1562.md']",[None],['windows_os'],['registry_event'],m365d_agent,m365d_security_center,,,m365d_security_center,device_registry_events,,api_advanced_hunting,,,DeviceRegistryEvents,"| where RegistryKey has_all ('system', 'control', 'lsa')
  and RegistryKey has_any ('HKLM', 'HKEY_LOCAL_MACHINE')
  and RegistryValueName =~ 'RestrictSendingNTLMTraffic'
  and RegistryValueData =~ '0'"
287,regt1003_pid_0003_sam_commandline,"['SAM Hive in Command Line', 'Also for offline cred dumping attack']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\sam ', @'HKEY_LOCAL_MACHINE\sam ')"
288,regt1562_pid_0002_netntlm_downgrade_restrict_sending_ntlm_traffic,"['Registry Modification of Key HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0', 'Property = RestrictSendingNTLMTraffic', 'Setting to 0 disables']",single_line_match,1,kql,[None],['t1562'],,"['ref_registry.md', 'ref_registry_t1562.md']",[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'RestrictSendingNTLMTraffic'
  and ProcessCommandLine contains '0'"
289,regt1003_pid_0005_save_system,"['reg.exe used to save security hive file for potential enumeration', 'Also for offline cred dumping attack']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\system ', @'HKEY_LOCAL_MACHINE\system ')
  and ProcessCommandLine has_any('save', 'export')"
290,regt1003_pid_0006_security_commandline,"['reg.exe used to save security hive file for potential enumeration', 'Also for offline cred dumping attack']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\security ', @'HKEY_LOCAL_MACHINE\security ')"
291,registryt1562_pid_0001_anti_spyware_disable,"['Powershell Used to Modify Registry', 'Disable Anit Spyware']",single_line_match,1,kql,[None],['t1562'],,['art_t1562001_test18_uid_1b3e0146-a1e5-4c5c-89fb-1bb2ffe8fc45'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any ('HKLM', 'HKEY_LOCAL_MACHINE')
  and ProcessCommandLine has_all ('Set', 'ItemProperty', 'DisableAntiSpyWare')"
292,registryt1003_pid_0004_export_lsa_secrets,['Powershell Used to Export Lsa Secrets from Registry'],single_line_match,1,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\system ', @'HKEY_LOCAL_MACHINE\system ')
  and ProcessCommandLine has_all('security', 'policy', 'secrets')
| where ProcessCommandLine has_all ('Get', 'Property', 'Out', 'File')
  or ProcessCommandLine has_all ('Export', 'CliXml')"
293,registryt1003_pid_0003_system,['Powershell Used to Export System Hive'],single_line_match,2,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\system ', @'HKEY_LOCAL_MACHINE\system ')
| where ProcessCommandLine has_all ('Get', 'Property', 'Out', 'File')
  or ProcessCommandLine has_all ('Export', 'CliXml')"
294,regt1003_pid_0002_save_security.yaml,"['reg.exe used to save Security Hive for potential enumeration', 'Also for offline cred dumping attack']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\security ', @'HKEY_LOCAL_MACHINE\security ')
  and ProcessCommandLine has_any ('save', 'export')
"
295,registryt1003_pid_0001_sam,['Powershell Used to export SAM Hive'],single_line_match,2,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\sam ', @'HKEY_LOCAL_MACHINE\sam ')
| where ProcessCommandLine has_all ('Get', 'Property', 'Out', 'File')
  or ProcessCommandLine has_all ('Export', 'CliXml')"
296,regt1003_pid_0004_security_commandline.yaml,"['Security Hive in CommandLine for potential enumeration', 'Also for offline cred dumping attack']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\security ', @'HKEY_LOCAL_MACHINE\security ')"
297,regt1003_pid_0007_save_lsa_secrets,"['reg.exe used to dump LSA secrets', 'LSA secrets are stored in the registry']",single_line_match,1,kql,[None],['t1003'],,['ref_registry.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('secrets', 'security')
  and ProcessCommandLine has_any ('HKLM', 'HKEY_LOCAL_MACHINE')
  and ProcessCommandLine has_any  ('save', 'export')"
298,registryt1003_pid_0002_security,['Powershell Used to Export Security HIVE'],single_line_match,2,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any (@'HKLM\security ', @'HKEY_LOCAL_MACHINE\security ')
| where ProcessCommandLine has_all ('Get', 'Property', 'Out', 'File')
  or ProcessCommandLine has_all ('Export', 'CliXml')"
299,mavinject_pid_0001_inject_dll,['MAVINJECT injecting arbitrary dll file'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'mavinject'
  or ProcessVersionInfoOriginalFileName has 'mavinject'
| where ProcessCommandLine contains '/INJECTRUNNING'
  or InitiatingProcessCommandLine contains '/INJECTRUNNING'
| where ProcessCommandLine contains '.dll'"
300,keymgr_pid_0001_cred_dump,['rundll32 using key manager to dump creds'],single_line_match,2,kql,[None],['t1003'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('keymgr', 'krshowkeymgr')
  and ProcessCommandLine contains 'rundll'"
301,wuauclt_pid_0001_execute_dll,['wuauclt executing dll'],single_line_match,2,kql,[None],[None],,[None],['wuauclt.exe /UpdateDeploymentProvider [Full_Path_To_DLL] /RunHandlerComServer'],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('wuaclt', 'RunHandlerComServer', 'UpdateDeploymentProvider')
  and ProcessCommandLine contains '.dll'
| where ProcessCommandLine !contains 'UpdateDeploymentProvider.dll' 
  and ProcessCommandLine !contains 'UpdateDeploy.dll' 
  and ProcessCommandLine !contains 'wuaueng.dll'"
302,appcmd_pid_0002_list_creds,['List service account credentials from app pools on a server'],single_line_match,2,kql,[None],['t1003'],,['ref_appcmd.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('list', 'apppool')    
| where ProcessCommandLine contains @'/@t:*'
  or ProcessCommandLine contains @'/@text:*'
  or ProcessCommandLine contains @'/text:*'"
303,appcmd_pid_0001_list_config,['List service account credentials from app pools on a server'],single_line_match,2,kql,[None],['t1003'],,['ref_appcmd.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('list', 'apppool', 'config')
  and ProcessCommandLine contains @'/config'"
304,infdefualtinstall_pid_0001_executing_inf,['infdefaultinstall used to execute .inf file'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'InfDefaultInstall'
  or ProcessVersionInfoOriginalFileName has 'InfDefaultInstall'
| where ProcessCommandLine contains '.inf'"
305,procdump_pid_0002_minidump_flag_lsass,-Procdump creating mini dump of Lsass process,single_line_match,1,kql,[None],['t1003'],,['ref_procdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any ('procdump', 'procdump64')
| where ProcessCommandLine has_all ('accepteula', '-mm', 'lsass')"
306,procdump_pid_0003_fulldump_flag,-Procdump creating full dump of a process,single_line_match,3,kql,[None],['t1003'],,['ref_procdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any ('procdump', 'procdump64')
| where ProcessCommandLine has_all ('accepteula', '-ma')"
307,procdump_pid_0005_any_dump_flag,-Procdump creating dump of a process,single_line_match,3,kql,[None],['t1003'],,['ref_procdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has 'accepteula'
  and ProcessCommandLine contains '-accepteula'
| where ProcessCommandLine has_any ('-ma', '-mm', '-mt', '-mp', '-mc', '-md', '-mk')"
308,procdump_pid_0001_minidump_flag,-Procdump creating mini dump of a process,single_line_match,3,kql,[None],['t1003'],,['ref_procdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any ('procdump', 'procdump64')
| where ProcessCommandLine has_all ('accepteula', '-mm')"
309,procdump_pid_0004_fulldump_flag_lsass,-Procdump creating full dump of Lsass process,single_line_match,1,kql,[None],['t1003'],,['ref_procdump.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_any ('procdump', 'procdump64')
| where ProcessCommandLine has_all ('accepteula', '-ma', 'lsass')"
310,sysmon_pid_0001_uninstall,['Uninstalling sysmon'],single_line_match,3,kql,[None],['t1562'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('sysmon', '-u')"
311,fltmc_pid_0001_unloading_sysmon,"['Filter Manager Control Program', 'Unloading Sysmon', 'SysmonDrv name may change']",single_line_match,3,kql,[None],['t1562'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('fltmc', 'unload')
  and ProcessCommandLine has_any ('SysmonDrv')"
312,mshta_pid_0003_rundll_executing_dll_hta,['abusing control.exe to execute dll file'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName startswith 'rundll'
  and (InitiatingProcessFileName has 'control' 
    or InitiatingProcessVersionInfoOriginalFileName has 'control')
| where ProcessCommandLine contains 'shell32.dll'
  and ProcessCommandLine contains 'Control_Rundll'"
313,control_pid_0002_executing_dll_hta,['abusing control.exe to execute dll file'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'control'
  or ProcessVersionInfoOriginalFileName has 'control'
| where ProcessCommandLine contains '.dll'"
314,control_pid_0001_executing_cpl_hta,['abusing control.exe to execute cpl file'],single_line_match,3,kql,[None],['t1218'],,[None],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where FileName has 'control'
  or ProcessVersionInfoOriginalFileName has 'control'
| where ProcessCommandLine contains '.cpl'"
315,esentutl_pid_0004_access_webcache,['Esentutl collecting browser data'],single_line_match,3,kql,[None],['t1005'],,['ref_esentutl.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('esentutl', '/r', 'webcache')
  and ProcessCommandLine has_any ('/d', '/s')"
316,esentutl_pid_0003_vss,['Esentutl creating a volume shadow copy'],single_line_match,1,kql,[None],['t1003'],,['ref_esentutl.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('esentutl', '/y', '/vss', '/d')
"
317,esentutl_pid_0002_vss_ntds,['Copy the NTDS using the esentutl Utility and Shadowcopy'],single_line_match,1,kql,[None],['t1003'],,['ref_esentutl.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('esentutl', '/y', '/vss', '/d')
  and ProcessCommandLine has_any ('ntds', @'ntds.dit')
"
318,esentutl_pid_0001_vss_sam,['Copy the SAM Hive using the esentutl Utility and Shadowcopy'],single_line_match,1,kql,[None],['t1003'],,['ref_esentutl.md'],[None],['windows_os'],['process_creation'],m365d_agent,m365d_security_center,,,m365d_security_center,device_process_events,,api_advanced_hunting,,,DeviceProcessEvents,"| where ProcessCommandLine has_all ('esentutl', '/y', '/vss', '/d', 'sam')"
319,kerb_pid_0007_4768_kdc_logon_without_pre_auth,['Logon without Pre-Authentication.'],single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4678,api_azure_monitor,,,SecurityEvent,"| where EventID == 4768
  and EventData contains @'PreAuthType"">0</Data'"
320,kerb_pid_0002_4768_kdc_err_policy,"['Failed kerberos auth ticket request', 'KDC_ERR_C_PRINCIPAL_UNKNOWN', 'Client not found in Kerberos database', 'The username does not exist']",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4678,api_azure_monitor,,,SecurityEvent,"| where EventID == 4768
  and TargetUserName !endswith '$'
  and Status =~ '0x6'"
321,kerb_pid_0014_4771_kdc_err_preauth_failed_single_ip,"['Kerberos Pre Auth Fail', 'KDC_ERR_PREAUTH_FAILED', 'Pre-authentication information was invalid', 'The wrong password was provided']",aggregate_threshold_match,5,kql,[None],['t1110'],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4771,api_azure_monitor,,let TriggerThreshold = 0;,SecurityEvent,"| where EventID == 4771
  and TargetUserName !endswith '$' 
  and Status =~ '0x18' 
| extend IpExtract = extract(@'([0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3})' , 0 , IpAddress)
| summarize AccountSet=make_set(TargetUserName) by IpExtract, ServiceName, Status, EventID, bin(TimeGenerated, 1h)
| extend AccountCount = array_length(AccountSet)
| where AccountCount >= TriggerThreshold"
322,kerb_pid_0006_4768_kdc_local_auth_failure,"['All Client Address ::1 means local authentication', 'If you know the list of accounts which should log on to the domain controllers,', 'then you need to monitor for all possible violations', ""Account Name isn't allowed to log on to any domain controller""]",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4678,api_azure_monitor,,,SecurityEvent,"| where EventID == 4768
  and TargetUserName !endswith '$'
  and IpAddress == '::1'
  and Status == '0x0'"
323,kerb_pid_0009_4771_kdc_err_c_principal_unknown,"['Kerberos Pre Auth Fail', 'KDC_ERR_C_PRINCIPAL_UNKNOWN', 'Client not found in Kerberos database', 'The username does not exist']",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4771,api_azure_monitor,,,SecurityEvent,"| where EventID == 4771
  and TargetUserName !endswith '$'
  and Status =~ '0x6'"
324,kerb_pid_0012_4771_kdc_err_key_expired,"['Kerberos Pre Auth Fail', 'KDC_ERR_KEY_EXPIRED', ""The user's password has expired""]",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4771,api_azure_monitor,,,SecurityEvent,"| where EventID == 4771
  and TargetUserName !endswith '$'
  and Status =~ '0x17'"
325,kerb_pid_0011_4771_kdc_err_client_revoked,"['Kerberos Pre Auth Fail', 'KDC_ERR_CLIENT_REVOKED', 'Clients credentials have been revoked']",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4771,api_azure_monitor,,,SecurityEvent,"| where EventID == 4771
  and TargetUserName !endswith '$'
  and Status =~ '0x12'"
326,kerb_pid_0008_4768_kdc_err_c_principal_single_ip,['Failed Logon Exceeded Threshhold'],aggregate_threshold_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4678,api_azure_monitor,,let TriggerThreshold = 0;,SecurityEvent,"| where EventID == 4768
  and TargetUserName !endswith '$'
  and Status =~ '0x6'
| extend IpExtract = extract(@'([0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3})' , 0 , IpAddress) 
| summarize AccountSet=make_set(TargetUserName) by IpExtract, ServiceName, Status, EventID, bin(TimeGenerated, 1h)
| extend AccountCount = array_length(AccountSet)
| where AccountCount >= TriggerThreshold"
327,kerb_pid_0010_4771_kdc_err_policy,"['Kerberos Pre Auth Fail', 'KDC_ERR_POLICY', 'KDC policy rejects request']",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4771,api_azure_monitor,,,SecurityEvent,"| where EventID == 4771
  and TargetUserName !endswith '$'
  and Status =~ '0xc'"
328,kerb_pid_0013_4771_kdc_err_preauth_failed,"['Kerberos Pre Auth Fail', 'KDC_ERR_PREAUTH_FAILED', 'Pre-authentication information was invalid', 'The wrong password was provided']",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4771,api_azure_monitor,,,SecurityEvent,"| where EventID == 4771
  and TargetUserName !endswith '$'
  and Status =~ '0x18'"
329,kerb_pid_0004_4768_kdc_err_key_expired,"['Failed kerberos auth ticket request', 'KDC_ERR_KEY_EXPIRED', 'Password has expiredchange password to reset', 'The users password has expired.']",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4678,api_azure_monitor,,,SecurityEvent,"| where EventID == 4768
  and TargetUserName !endswith '$'
  and Status =~ '0x17'"
330,kerb_pid_0003_4768_kdc_err_client_revoked,"['Failed kerberos auth ticket request', 'KDC_ERR_CLIENT_REVOKED', 'Clients credentials have been revoked', 'This might be because of an explicit disabling or because of other restrictions in place on the account', 'Example account disabled, expired, or locked out']",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4678,api_azure_monitor,,,SecurityEvent,"| where EventID == 4768
  and TargetUserName !endswith '$'
  and Status =~ '0x12'"
331,kerb_pid_0005_4768_kdc_local_auth_failure,"['All Client Address ::1 means local authentication', 'If you know the list of accounts which should log on to the domain controllers,', 'then you need to monitor for all possible violations', ""Account Name isn't allowed to log on to any domain controller""]",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4678,api_azure_monitor,,,SecurityEvent,"| where EventID == 4768
  and TargetUserName !endswith '$'
  and IpAddress == '::1'
  and Status != '0x0'"
332,kerb_pid_0002_4768_kdc_err_policy,"['Failed kerberos auth ticket request', 'KDC_ERR_POLICY', 'Requested start time is later than end time', 'This error is usually the result of logon restrictions in place on a users account', 'For example workstation restriction, smart card authentication requirement or logon time restriction']",single_line_match,5,kql,[None],[None],,['ref_kerberos.md'],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4678,api_azure_monitor,,,SecurityEvent,"| where EventID == 4768
  and TargetUserName !endswith '$'
  and Status =~ '0xC'"
333,logon_pid_0011_4625_status_smartcard_no_card,"['Failed logons', 'STATUS_SMARTCARD_NO_CARD', 'No smart card is available.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000383'
  or SubStatus =~ '0xC0000383'"
334,logon_pid_0009_4625_status_smartcard_blocked,"['Failed logons', 'STATUS_SMARTCARD_CARD_BLOCKED', 'The smart card is blocked.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000381'
  or SubStatus =~ '0xC0000381'"
335,logon_pid_0014_4625_status_smartcard_no_keyset,"['Failed logons', 'STATUS_SMARTCARD_NO_KEYSET', 'The requested keyset does not exist']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000386'
  or SubStatus =~ '0xC0000386'"
336,logon_pid_0010_4625_status_smartcard_not_authenticated,"['Failed logons', 'STATUS_SMARTCARD_CARD_NOT_AUTHENTICATED', 'No PIN was presented to the smart card']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000382'
  or SubStatus =~ '0xC0000382'"
337,logon_pid_0022_4625_status_pwd_must_change,"['Failed logons', 'STATUS_PASSWORD_MUST_CHANGE', 'The user password must be changed before logging on the first time']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000224'
  or SubStatus =~ '0xC0000224'"
338,logon_pid_0012_4625_status_smartcard_no_key_container,"['Failed logons', 'STATUS_SMARTCARD_NO_KEY_CONTAINER', 'The requested key container does not exist on the smart card']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000384'
  or SubStatus =~ '0xC0000384'"
339,logon_pid_0002_4625_status_acnt_disabled,"['Failed logons', 'STATUS_ACCOUNT_DISABLED', 'The referenced account is currently disabled and cannot be logged on to.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000072'
  or SubStatus =~ '0xC0000072'"
340,logon_pid_0007_4625_status_acnt_restriction,"['Failed logons', 'STATUS_ACCOUNT_RESTRICTION', 'Indicates a referenced user name and authentication information are valid', 'some user account restriction has prevented successful authentication (such as time-of-day restrictions)']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC000006E'
  or SubStatus =~ '0xC000006E'"
341,logon_pid_0004_4625_status_no_such_user,"['Failed logons', 'STATUS_INVALID_ACCOUNT_NAME', 'The name provided is not a properly formed account name.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000062'
  or SubStatus =~ '0xC0000062'"
342,logon_pid_0021_4625_status_ltrusted_relationship_fail,"['Failed logons', 'STATUS_TRUSTED_RELATIONSHIP_FAILURE', 'The logon request failed because the trust relationship between this workstation and the primary domain failed']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC000018D'
  or SubStatus =~ '0xC000018D'"
343,logon_pid_0006_4625_status_wrong_pwd,"['Failed logons', 'STATUS_WRONG_PASSWORD', 'This return status indicates that the value provided as the current password is not correct', 'When trying to update password']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC000006A'
  or SubStatus =~ '0xC000006A'"
344,logon_pid_0019_4625_status_dc_time_diff,"['Failed logons', 'STATUS_TIME_DIFFERENCE_AT_DC', 'The time at the primary domain controller is different from the time at the backup domain controller or member server by too large an amount.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000133'
  or SubStatus =~ '0xC0000133'"
345,logon_pid_0016_4625_status_pwd_expired,"['Failed logons', 'STATUS_SMARTCARD_CERT_EXPIRED', 'The smart card certificate used for authentication has expired']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000071'
  or SubStatus =~ '0xC0000071'"
346,logon_pid_0017_4625_status_smartcard_logon_required,"['Failed logons', 'STATUS_SMARTCARD_LOGON_REQUIRED', 'Smart card logon is required and was not used']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC00002FA'
  or SubStatus =~ '0xC00002FA'"
347,logon_pid_0008_4625_status_smartcard_wrong_pin,"['Failed logons', 'STATUS_SMARTCARD_WRONG_PIN', 'An incorrect PIN was presented to the smart card']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000380'
  or SubStatus =~ '0xC0000380'"
348,logon_pid_0013_4625_status_smartcard_no_certificates,"['Failed logons', 'STATUS_SMARTCARD_NO_CERTIFICATE', 'The requested certificate does not exist on the smart card']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000385'
  or SubStatus =~ '0xC0000385'"
349,logon_pid_0001_4625_status_logon_failure,"['Failed logons', 'STATUS_LOGON_FAILURE', 'The attempted logon is invalid.', 'This is either due to a bad username or authentication information.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xc000006d'
  or SubStatus =~ '0xc000006d'"
350,logon_pid_0018_4625_status_sync_required,"['Failed logons', 'STATUS_SYNCHRONIZATION_REQUIRED', 'The SAM database is significantly out of synchronization with the copy on the domain controller.', 'A complete synchronization is required.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000134'
  or SubStatus =~ '0xC0000134'"
351,logon_pid_0023_4625_status_acnt_locked_out,"['Failed logons', 'STATUS_ACCOUNT_LOCKED_OUT', 'The user account has been automatically locked because too many invalid logon attempts or password change attempts have been requested']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000234'
  or SubStatus =~ '0xC0000234'"
352,logon_pid_0004_4625_status_no_such_user,"['Failed logons', 'STATUS_NO_SUCH_USER', 'The specified account does not exist.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC0000064'
  or SubStatus =~ '0xC0000064'"
353,logon_pid_0024_4625_status_failure_single_ip,"['Failed logons', 'See Sub Status for fail type', 'Potential Password Spray']",aggregate_threshold_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,let TriggerThreshold = 0;,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
  and Status == '0xc000006d'
| summarize AccountSet=make_set(TargetUserName), SubStatusSet=make_set(SubStatus) 
  by IpAddress, EventID, TargetDomainName, bin(TimeGenerated, 1h) 
| extend AccountCount = array_length(AccountSet)
| where AccountCount >= TriggerThreshold"
354,logon_pid_0020_4625_status_logon_type_note_granted,"['Failed logons', 'STATUS_LOGON_TYPE_NOT_GRANTED', 'A user has requested a type of logon (for example, interactive or network) that has not been granted', 'An administrator has control over who can logon interactively and through the network']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC000005E'
  or SubStatus =~ '0xC000005E'"
355,logon_pid_0003_4625_status_invalid_logon_hrs,"['Failed logons', 'STATUS_INVALID_LOGON_HOURS', 'The user account has time restrictions and cannot be logged onto at this time.']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC000006F'
  or SubStatus =~ '0xC000006F'"
356,logon_pid_0015_4625_status_smartcard_card_expired,"['Failed logons', 'STATUS_SMARTCARD_CERT_EXPIRED', 'The smart card certificate used for authentication has expired']",single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4625,api_azure_monitor,,,SecurityEvent,"| where EventID == 4625 
  and AccountType == 'User' 
| where Status =~ '0xC000038D'
  or SubStatus =~ '0xC000038D'"
357,uam_pid_0002_4738_user_normal_acnt_pwd_not_required,['User Account Change'],single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4738,api_azure_monitor,,let TriggerThreshold = 0;,SecurityEvent,"| where EventID == 4738 
  and AccountType == 'User' 
  and NewUacValue =~ '0x14'"
358,uam_pid_0003_4738_user_normal_acnt_pwd_not_required_dont_expire,['User Account Change'],single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4738,api_azure_monitor,,let TriggerThreshold = 0;,SecurityEvent,"| where EventID == 4738 
  and AccountType == 'User' 
  and NewUacValue =~ '0x214'"
359,uam_pid_0001_4738_user_normal_acnt_dont_expire_pwd,['User Account Change'],single_line_match,5,kql,[None],[None],,[None],[None],['active_directory_domain_controller'],['windows_security_event_log'],ama_agent,msft_sentinel,,,azure_monitor,security_event,event_id_4738,api_azure_monitor,,let TriggerThreshold = 0;,SecurityEvent,"| where EventID == 4738 
  and AccountType == 'User' 
  and NewUacValue =~ '0x210'"
